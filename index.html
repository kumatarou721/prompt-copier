<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0f172a">
  <title>US Stock Analyzer - Command Center</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Chakra Petch"', 'sans-serif'],
            display: ['"Orbitron"', 'sans-serif'],
            mono: ['"JetBrains Mono"', 'monospace'],
          },
          colors: {
            bg: {
              main: '#030712', // gray-950 darker
              card: 'rgba(17, 24, 39, 0.7)', // gray-900/70
            },
            neon: {
              blue: '#3b82f6',
              purple: '#8b5cf6',
              cyan: '#06b6d4',
              green: '#10b981',
              amber: '#f59e0b',
              red: '#ef4444',
            }
          },
          backgroundImage: {
            'cyber-grid': "linear-gradient(rgba(17, 24, 39, 0.9), rgba(3, 7, 18, 0.95)), url('data:image/svg+xml,%3Csvg width=\\'40\\' height=\\'40\\' viewBox=\\'0 0 40 40\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cpath d=\\'M0 0h40v40H0V0zm1 1h38v38H1V1z\\' fill=\\'%233b82f6\\' fill-opacity=\\'0.05\\' fill-rule=\\'evenodd\\'/%3E%3C/svg%3E')",
          },
          boxShadow: {
            'glow-blue': '0 0 15px rgba(59, 130, 246, 0.3)',
            'glow-amber': '0 0 15px rgba(245, 158, 11, 0.3)',
            'glow-green': '0 0 15px rgba(16, 185, 129, 0.3)',
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'border-flow': 'borderFlow 3s ease infinite',
          },
          keyframes: {
            borderFlow: {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    /* Glassmorphism Utilities */
    .glass-panel {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .glass-panel-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @media (hover: hover) {
      .glass-panel-hover:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      }
    }

    /* Text Glow Utilities */
    .text-glow-blue { text-shadow: 0 0 10px rgba(59, 130, 246, 0.7); }
    .text-glow-amber { text-shadow: 0 0 10px rgba(245, 158, 11, 0.7); }
    .text-glow-green { text-shadow: 0 0 10px rgba(16, 185, 129, 0.7); }
    
    /* Input Reset */
    input[type="number"]::-webkit-inner-spin-button, 
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

    /* Grid layout tweaks */
    .grid-dashboard {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    @media (min-width: 1024px) {
      .grid-dashboard {
        grid-template-columns: 1fr 320px; /* Main content + Sidebar */
      }
    }
    @media (min-width: 1280px) {
      .grid-dashboard {
        grid-template-columns: 1fr 380px;
      }
    }
    
    /* Utility class for spanning full width in grid */
    .col-span-full {
      grid-column: 1 / -1;
    }
  </style>
</head>
<body class="bg-bg-main bg-cyber-grid text-slate-200 min-h-screen font-sans selection:bg-neon-blue selection:text-white pb-24 lg:pb-10">

  <header class="fixed top-0 left-0 right-0 z-50 glass-panel border-b border-white/5 bg-opacity-90 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full bg-neon-green animate-pulse"></div>
        <h1 class="font-display font-bold text-lg tracking-wider bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">
          US STOCK <span class="hidden sm:inline">ANALYZER</span>
        </h1>
      </div>
      
      <div id="header-status" class="flex items-center gap-4 text-xs font-mono hidden">
        <div class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/10">
          <span class="text-slate-400">MARKET:</span>
          <span id="market-regime-badge" class="font-bold text-white">--</span>
        </div>
        <div class="text-slate-500 hidden sm:block" id="header-date">--</div>
      </div>

      <button onclick="location.reload()" class="p-2 text-slate-400 hover:text-white active:scale-95 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
      </button>
    </div>
  </header>

  <main class="pt-20 px-4 max-w-7xl mx-auto">
    
    <div id="loader-screen" class="min-h-[70vh] flex flex-col items-center justify-center fade-in">
      <div class="w-full max-w-md p-1">
        <div class="glass-panel rounded-2xl p-8 text-center relative overflow-hidden group">
          <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-cyan-500"></div>
          
          <div class="mb-6 inline-flex items-center justify-center w-20 h-20 rounded-full bg-slate-800/50 border border-slate-700 group-hover:border-blue-500/50 group-hover:shadow-glow-blue transition-all duration-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          </div>
          
          <h2 class="text-2xl font-display font-bold text-white mb-2">Load Data Module</h2>
          <p class="text-slate-400 text-sm mb-8">Select <code class="bg-slate-900 px-1.5 py-0.5 rounded text-blue-300">mobile_prompts.json</code> to initialize</p>
          
          <label class="block w-full">
            <span class="sr-only">Choose file</span>
            <input type="file" id="file-input" accept=".json" class="block w-full text-sm text-slate-400
              file:mr-4 file:py-2.5 file:px-6
              file:rounded-full file:border-0
              file:text-sm file:font-bold file:font-display
              file:bg-blue-600 file:text-white
              hover:file:bg-blue-500
              active:file:scale-95 transition-all
              cursor-pointer mx-auto
            "/>
          </label>
        </div>
      </div>
    </div>

    <div id="dashboard" class="hidden animate-in fade-in zoom-in duration-300">
      
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
        <div class="glass-panel glass-panel-hover rounded-xl p-4 relative overflow-hidden">
          <div class="absolute top-0 right-0 p-3 opacity-10"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg></div>
          <h3 class="text-blue-400 text-xs font-display font-bold uppercase tracking-wider mb-1">Long-Term</h3>
          <div class="flex items-baseline gap-1">
            <span id="lt-signal-count" class="text-3xl font-mono font-bold text-white">--</span>
            <span class="text-xs text-slate-500 font-bold">Signals</span>
          </div>
          <div class="mt-2 flex gap-3 text-xs font-mono text-slate-400">
            <span>Wait: <span id="lt-watch" class="text-slate-200">--</span></span>
            <span>Ready: <span id="lt-ready" class="text-blue-300 font-bold">--</span></span>
          </div>
        </div>

        <div class="glass-panel glass-panel-hover rounded-xl p-4 relative overflow-hidden">
          <div class="absolute top-0 right-0 p-3 opacity-10"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><path d="M2 12h5"/><path d="M17 12h5"/><path d="M7 12a5 5 0 0 1 5-5 5 5 0 0 1 5 5"/></svg></div>
          <h3 class="text-amber-400 text-xs font-display font-bold uppercase tracking-wider mb-1">Swing</h3>
          <div class="flex items-baseline gap-1">
            <span id="swing-signal-count" class="text-3xl font-mono font-bold text-white">--</span>
            <span class="text-xs text-slate-500 font-bold">Signals</span>
          </div>
          <div class="mt-2 flex gap-3 text-xs font-mono text-slate-400">
            <span>Wait: <span id="swing-watch" class="text-slate-200">--</span></span>
            <span>Ready: <span id="swing-ready" class="text-amber-300 font-bold">--</span></span>
          </div>
        </div>

        <div class="glass-panel glass-panel-hover rounded-xl p-4">
          <h3 class="text-slate-400 text-xs font-display font-bold uppercase tracking-wider mb-1">Watchlist</h3>
          <div class="flex items-baseline gap-1">
            <span id="stat-watch" class="text-2xl font-mono font-bold text-white">--</span>
            <span class="text-xs text-slate-500">Total</span>
          </div>
          <div class="mt-3 h-1 w-full bg-slate-800 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-blue-500 to-amber-500 w-0 transition-all duration-1000"></div>
          </div>
        </div>

        <div class="glass-panel glass-panel-hover rounded-xl p-4">
          <h3 class="text-slate-400 text-xs font-display font-bold uppercase tracking-wider mb-1">Charts</h3>
          <div class="flex items-baseline gap-1">
            <span id="stat-charts" class="text-2xl font-mono font-bold text-white">--</span>
            <span class="text-xs text-slate-500">Generated</span>
          </div>
          <div class="mt-2 text-xxs text-slate-500">Check Google Drive</div>
        </div>
      </div>

      <div class="grid-dashboard">
        
        <div class="col-span-full space-y-3">
          <div id="signal-alert" class="hidden p-4 rounded-xl border transition-all duration-300 flex items-center gap-3">
            <div class="p-2 rounded-full bg-slate-900/50" id="alert-icon">
              </div>
            <div>
              <h3 id="signal-alert-title" class="font-display font-bold text-sm">--</h3>
              <p id="signal-alert-desc" class="text-xs text-slate-400 mt-0.5">--</p>
            </div>
          </div>

          <button onclick="copyPrompt('translate')" class="w-full glass-panel hover:bg-slate-800/50 transition-colors rounded-lg p-2.5 flex items-center justify-center gap-2 text-xs font-mono font-bold text-slate-400 hover:text-blue-300 border border-white/5 shadow-sm active:scale-[0.99]">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>
            <span>COPY TRANSLATION PROMPT</span>
          </button>
        </div>

        <div class="col-span-full">
          <div class="glass-panel rounded-xl overflow-hidden border border-white/10">
            <button onclick="toggleCrossVal()" class="w-full p-4 flex items-center justify-between bg-white/5 hover:bg-white/10 transition-colors text-left group">
              <div class="flex items-center gap-3">
                <div class="p-1.5 rounded bg-cyan-500/20 text-cyan-400 group-hover:bg-cyan-500/30 group-hover:text-cyan-300 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                </div>
                <div>
                  <div class="text-xs font-bold font-display uppercase tracking-wider text-cyan-100">Step 3 & 4: Final Decision</div>
                  <div class="text-[10px] text-slate-400">Summary & Cross-Validation</div>
                </div>
              </div>
              <svg id="crossval-icon" class="w-4 h-4 text-slate-500 transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            
            <div id="crossval-panel" class="hidden bg-black/20">
              
              <div class="p-4 border-b border-white/5 bg-indigo-900/10">
                <div class="flex items-center gap-2 mb-3">
                  <span class="bg-indigo-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">STEP 3</span>
                  <span class="text-xs font-bold text-indigo-200 uppercase tracking-wide">Generate AI Summary</span>
                </div>
                <p class="text-[10px] text-slate-400 mb-3">
                  First, ask both Gemini and Claude to summarize their Phase 1 & 2 analysis using these prompts.
                </p>
                <div class="flex gap-2">
                  <button onclick="copyPrompt('lt_summary')" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98] border border-indigo-400/50 shadow-lg shadow-indigo-900/50">
                    üìã Copy LT Summary
                  </button>
                  <button onclick="copyPrompt('swing_summary')" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98] border border-indigo-400/50 shadow-lg shadow-indigo-900/50">
                    üìã Copy Swing Summary
                  </button>
                </div>
              </div>

              <div class="p-4">
                <div class="flex items-center gap-2 mb-3">
                  <span class="bg-cyan-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">STEP 4</span>
                  <span class="text-xs font-bold text-cyan-200 uppercase tracking-wide">Cross-Validation</span>
                </div>
                <p class="text-[10px] text-slate-400 mb-3">
                  Paste the summaries (C1 & C2) below to generate the final decision prompt.
                </p>

                <div class="space-y-4">
                  <div class="grid grid-cols-1 gap-3">
                    <div class="relative group">
                      <span class="absolute top-2 left-3 text-[9px] font-bold text-slate-500 uppercase group-focus-within:text-cyan-400 transition-colors">Gemini Summary (C1)</span>
                      <textarea id="gemini-summary" rows="2" class="w-full bg-slate-900/80 border border-slate-700 rounded-lg p-3 pt-6 text-[10px] text-slate-300 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none resize-none transition-all" placeholder="Paste Gemini's summary here..."></textarea>
                    </div>
                    <div class="relative group">
                      <span class="absolute top-2 left-3 text-[9px] font-bold text-slate-500 uppercase group-focus-within:text-cyan-400 transition-colors">Claude Summary (C2)</span>
                      <textarea id="claude-summary" rows="2" class="w-full bg-slate-900/80 border border-slate-700 rounded-lg p-3 pt-6 text-[10px] text-slate-300 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none resize-none transition-all" placeholder="Paste Claude's summary here..."></textarea>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-3">
                    <button onclick="generateCrossVal('lt')" class="bg-cyan-900/40 hover:bg-cyan-800/60 border border-cyan-500/30 hover:border-cyan-400/50 text-cyan-300 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex flex-col items-center justify-center gap-1">
                      <span>üî¨ LT VERIFY</span>
                      <span class="text-[9px] opacity-60 font-normal">Generate Final Prompt</span>
                    </button>
                    <button onclick="generateCrossVal('swing')" class="bg-amber-900/40 hover:bg-amber-800/60 border border-amber-500/30 hover:border-amber-400/50 text-amber-300 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex flex-col items-center justify-center gap-1">
                      <span>‚öñÔ∏è SWING VERIFY</span>
                      <span class="text-[9px] opacity-60 font-normal">Generate Final Prompt</span>
                    </button>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div id="lt-section" class="glass-panel rounded-xl p-5 border-l-4 border-l-blue-500 hidden relative overflow-hidden">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-2">
              <span class="text-lg">üìà</span>
              <h3 class="font-display font-bold text-sm text-blue-400 uppercase tracking-widest">Long-Term</h3>
            </div>
            <div id="badge-long" class="text-[9px] bg-blue-900/50 text-blue-300 px-1.5 py-0.5 rounded border border-blue-800 hidden">0 SIG</div>
          </div>

          <div class="space-y-3">
            <div class="flex gap-2">
              <button onclick="copyPrompt('long_p1')" id="btn-long-p1" class="flex-1 bg-slate-800 hover:bg-blue-900/20 border border-slate-700 hover:border-blue-500/50 text-slate-300 py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98]">
                1. Quick Screen
              </button>
              <div class="text-slate-600 flex items-center">‚Üí</div>
              <button onclick="copyPrompt('long_p2')" id="btn-long-p2" class="flex-1 bg-slate-800 hover:bg-blue-900/20 border border-slate-700 hover:border-blue-500/50 text-slate-300 py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98]">
                2. Deep Analysis
              </button>
            </div>
          </div>
          
          <div id="lt-signal-list" class="mt-4 pt-4 border-t border-white/5 space-y-2"></div>
        </div>

        <div id="swing-section" class="glass-panel rounded-xl p-5 border-l-4 border-l-amber-500 hidden relative overflow-hidden">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-2">
              <span class="text-lg">üèÑ</span>
              <h3 class="font-display font-bold text-sm text-amber-400 uppercase tracking-widest">Swing</h3>
            </div>
            <div id="badge-swing" class="text-[9px] bg-amber-900/50 text-amber-300 px-1.5 py-0.5 rounded border border-amber-800 hidden">0 SIG</div>
          </div>

          <div class="space-y-3">
            <div class="flex gap-2">
              <button onclick="copyPrompt('swing_p1')" id="btn-swing-p1" class="flex-1 bg-slate-800 hover:bg-amber-900/20 border border-slate-700 hover:border-amber-500/50 text-slate-300 py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98]">
                1. Quick Screen
              </button>
              <div class="text-slate-600 flex items-center">‚Üí</div>
              <button onclick="copyPrompt('swing_p2')" id="btn-swing-p2" class="flex-1 bg-slate-800 hover:bg-amber-900/20 border border-slate-700 hover:border-amber-500/50 text-slate-300 py-2.5 rounded-lg text-xs font-bold transition-all active:scale-[0.98]">
                2. Technical
              </button>
            </div>
          </div>
          
          <div id="swing-signal-list" class="mt-4 pt-4 border-t border-white/5 space-y-2"></div>
        </div>

        <div id="portfolio-section" class="glass-panel rounded-xl p-5 border-l-4 border-l-purple-500 hidden relative overflow-hidden">
          <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          </div>
          <div class="flex items-center justify-between mb-4 relative z-10">
            <div class="flex items-center gap-2">
              <span class="text-lg">üíº</span>
              <h3 class="font-display font-bold text-sm text-purple-400 uppercase tracking-widest">Portfolio</h3>
            </div>
            <span id="portfolio-health" class="px-2 py-1 rounded bg-slate-800 text-xs font-mono font-bold border border-slate-700">--</span>
          </div>

          <div id="sell-signals-container" class="mb-4 hidden">
            <div class="text-xs font-bold text-red-400 mb-2 flex items-center gap-1">
              <span class="animate-pulse">üö®</span> SELL SIGNALS
            </div>
            <div id="sell-signals-list" class="space-y-2"></div>
          </div>
          <div id="addon-signals-container" class="hidden mb-4">
            <div class="text-xs font-bold text-emerald-400 mb-2 flex items-center gap-1">
              <span>üí∞</span> ADD-ON OPPORTUNITIES
            </div>
            <div id="addon-signals-list" class="space-y-2"></div>
          </div>

          <div class="mt-4 pt-4 border-t border-white/5">
            <button onclick="copyPrompt('pf')" id="btn-pf" class="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-purple-500/50 text-purple-300 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="16" x2="16" y1="11" y2="13"/><line x1="8" x2="8" y1="11" y2="13"/><line x1="12" x2="12" y1="15" y2="13"/></svg>
              COPY REVIEW PROMPT
            </button>
          </div>
        </div>

        <div id="daytrade-section" class="glass-panel rounded-xl p-5 border-l-4 border-l-red-500 hidden">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-2">
              <span class="text-lg">üèéÔ∏è</span>
              <h3 class="font-display font-bold text-sm text-red-400 uppercase tracking-widest">Day Trade</h3>
            </div>
            <span id="market-hours" class="text-xxs font-bold px-2 py-0.5 rounded-full bg-slate-900 border border-slate-700 uppercase">--</span>
          </div>

          <div class="grid grid-cols-3 gap-2 mb-4">
            <div class="bg-slate-900/60 rounded-lg p-2 text-center border border-slate-800">
              <div class="text-[10px] text-slate-500 font-bold">VWAP</div>
              <div id="vwap-status" class="text-xs font-mono font-bold mt-1">--</div>
            </div>
            <div class="bg-slate-900/60 rounded-lg p-2 text-center border border-slate-800">
              <div class="text-[10px] text-slate-500 font-bold">ORB</div>
              <div id="orb-status" class="text-xs font-mono font-bold mt-1">--</div>
            </div>
            <div class="bg-slate-900/60 rounded-lg p-2 text-center border border-slate-800">
              <div class="text-[10px] text-slate-500 font-bold">GAP</div>
              <div id="gap-status" class="text-xs font-mono font-bold mt-1">--</div>
            </div>
          </div>

          <div id="daytrade-candidates" class="hidden mb-4">
            <div class="text-[10px] text-slate-400 uppercase font-bold mb-2 tracking-wider">Momentum Picks</div>
            <div id="daytrade-list" class="space-y-2"></div>
          </div>

          <div class="pt-4 border-t border-white/5">
            <button onclick="copyPrompt('short')" id="btn-day" class="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-red-500/50 text-red-400 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>
              COPY DAY TRADE PROMPT
            </button>
          </div>
        </div>

        <div class="space-y-6">
          
          <div id="sector-section" class="glass-panel rounded-xl p-5 hidden">
            <div class="flex items-center gap-2 mb-4">
              <span class="text-lg">üîÑ</span>
              <h3 class="font-display font-bold text-sm text-emerald-400 uppercase tracking-widest">Sector Flow</h3>
            </div>
            <div class="space-y-3">
              <div>
                <div class="text-xxs text-slate-500 font-bold mb-1 uppercase">Strong Inflow (Buy Focus)</div>
                <div id="sector-top" class="flex flex-wrap gap-2"></div>
              </div>
              <div class="h-px bg-white/5 w-full"></div>
              <div>
                <div class="text-xxs text-slate-500 font-bold mb-1 uppercase">Weak Outflow (Avoid)</div>
                <div id="sector-bottom" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </div>

          <div class="glass-panel rounded-xl p-5">
            <h3 class="font-display font-bold text-xs text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
              Quick Calc
            </h3>
            <div class="space-y-3">
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Capital</label>
                  <input type="number" id="calc-eq" value="10000" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-right focus:border-blue-500 outline-none font-mono">
                </div>
                <div>
                  <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Risk %</label>
                  <input type="number" id="calc-risk" value="1.0" step="0.1" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-right focus:border-blue-500 outline-none font-mono">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Entry $</label>
                  <input type="number" id="calc-entry" placeholder="0.00" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-right focus:border-blue-500 outline-none font-mono">
                </div>
                <div>
                  <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Stop $</label>
                  <input type="number" id="calc-stop" placeholder="0.00" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-right focus:border-blue-500 outline-none font-mono">
                </div>
              </div>
              
              <div class="bg-slate-800/50 rounded-lg p-3 mt-2 border border-slate-700/50">
                <div class="flex justify-between items-center mb-1">
                  <span class="text-xs text-slate-400">Shares:</span>
                  <span id="res-shares" class="font-mono font-bold text-white text-lg">0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-xs text-slate-400">Size:</span>
                  <span id="res-cost" class="font-mono text-emerald-400 text-sm">$0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-xs text-slate-400">Risk Amt:</span>
                  <span id="res-risk" class="font-mono text-red-400 text-xs">$0</span>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div> </div> </main>

  <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] pointer-events-none opacity-0 transform translate-y-4 transition-all duration-300">
    <div class="bg-slate-800/90 backdrop-blur text-white px-4 py-2.5 rounded-full shadow-lg border border-white/10 flex items-center gap-2">
      <div class="bg-emerald-500 rounded-full p-0.5">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="text-slate-900"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <span id="toast-msg" class="text-sm font-bold font-display tracking-wide">COPIED</span>
    </div>
  </div>

  <script>
    let appData = null;

    // --- File Handling ---
    const fileInput = document.getElementById('file-input');
    fileInput.addEventListener('click', (e) => e.target.value = ''); // Allow re-select
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          // JSON sanitization
          let jsonStr = e.target.result
            .replace(/:\s*NaN\b/g, ': null')
            .replace(/:\s*Infinity\b/g, ': null')
            .replace(/:\s*-Infinity\b/g, ': null');
          
          appData = JSON.parse(jsonStr);
          renderDashboard(appData);
        } catch (error) {
          alert("Error parsing JSON: " + error.message);
        }
      };
      reader.readAsText(file);
    });

    // --- Dashboard Rendering ---
    function renderDashboard(data) {
      // Transition
      const loader = document.getElementById('loader-screen');
      if (loader) loader.classList.add('hidden');
      
      const dash = document.getElementById('dashboard');
      if (dash) dash.classList.remove('hidden');

      // 1. Header Info
      const meta = data.metadata || {};
      const dateEl = document.getElementById('header-date');
      if (dateEl) dateEl.textContent = formatTime(meta.generated_at);
      
      let regime = "NEUTRAL";
      if (data.prompts && data.prompts.long_p1) {
        const match = data.prompts.long_p1.match(/Market: ([A-Z_]+)/);
        if (match) regime = match[1];
      }
      const regimeEl = document.getElementById('market-regime-badge');
      if (regimeEl) {
        regimeEl.textContent = regime;
        regimeEl.className = `font-bold ${getRegimeColor(regime)}`;
      }
      
      const headerStatus = document.getElementById('header-status');
      if (headerStatus) headerStatus.classList.remove('hidden');

      // 2. Stats & Visibility Logic
      const signals = data.signals || {};
      const ltCount = (signals.long_term || []).length;
      const swCount = (signals.swing || []).length;
      
      updateStat('lt-signal-count', ltCount);
      updateStat('swing-signal-count', swCount);
      
      // Reveal Sections based on data
      if (data.prompts?.long_p1 && data.prompts.long_p1.length > 50) {
        const ltSec = document.getElementById('lt-section');
        if (ltSec) ltSec.classList.remove('hidden');
        
        if (ltCount > 0) {
          const badge = document.getElementById('badge-long');
          if (badge) {
            badge.textContent = `${ltCount} SIG`;
            badge.classList.remove('hidden');
          }
        }
      }
      
      if (data.prompts?.swing_p1 && data.prompts.swing_p1.length > 50) {
        const swSec = document.getElementById('swing-section');
        if (swSec) swSec.classList.remove('hidden');
        
        if (swCount > 0) {
          const badge = document.getElementById('badge-swing');
          if (badge) {
            badge.textContent = `${swCount} SIG`;
            badge.classList.remove('hidden');
          }
        }
      }

      // Render Detailed Lists (New Function Call)
      renderSignals(data.signals?.long_term, 'lt-signal-list', 'text-blue-400');
      renderSignals(data.signals?.swing, 'swing-signal-list', 'text-amber-400');

      // Watchlist Stats
      const watchlists = data.watchlists || {};
      const ltWatch = document.getElementById('lt-watch');
      if (ltWatch) ltWatch.textContent = watchlists.long_term?.watching || 0;
      
      const ltReady = document.getElementById('lt-ready');
      if (ltReady) ltReady.textContent = watchlists.long_term?.ready || 0;
      
      const swWatch = document.getElementById('swing-watch');
      if (swWatch) swWatch.textContent = watchlists.swing?.watching || 0;
      
      const swReady = document.getElementById('swing-ready');
      if (swReady) swReady.textContent = watchlists.swing?.ready || 0;
      
      const statWatch = document.getElementById('stat-watch');
      if (statWatch) statWatch.textContent = (watchlists.long_term?.watching||0) + (watchlists.swing?.watching||0);
      
      const chartCount = Object.values(data.charts || {}).flat().length;
      const statCharts = document.getElementById('stat-charts');
      if (statCharts) statCharts.textContent = chartCount;

      setTimeout(() => {
        const total = (watchlists.long_term?.watching||0) + (watchlists.swing?.watching||0);
        const max = 100;
        const pct = Math.min(100, (total / max) * 100);
        const pBar = document.getElementById('progress-bar');
        if (pBar) pBar.style.width = `${pct}%`;
      }, 100);

      // 3. Alerts
      const totalSignals = ltCount + swCount;
      const alertDiv = document.getElementById('signal-alert');
      const alertIcon = document.getElementById('alert-icon');
      const alertTitle = document.getElementById('signal-alert-title');
      const alertDesc = document.getElementById('signal-alert-desc');
      
      if (alertDiv) {
        alertDiv.classList.remove('hidden');
        if (totalSignals > 0) {
          alertDiv.className = "p-4 rounded-xl border border-emerald-500/30 bg-emerald-900/10 flex items-center gap-3 shadow-glow-green";
          if (alertIcon) {
            alertIcon.innerHTML = "‚ö°";
            alertIcon.className = "p-2 rounded-full bg-emerald-500/20 text-emerald-400";
          }
          if (alertTitle) {
            alertTitle.textContent = `${totalSignals} SIGNALS DETECTED`;
            alertTitle.className = "font-display font-bold text-sm text-emerald-400";
          }
          if (alertDesc) alertDesc.textContent = `${ltCount} Long-Term / ${swCount} Swing`;
        } else {
          alertDiv.className = "p-4 rounded-xl border border-slate-800 bg-slate-900/30 flex items-center gap-3";
          if (alertIcon) {
            alertIcon.innerHTML = "üí§";
            alertIcon.className = "p-2 rounded-full bg-slate-800 text-slate-500";
          }
          if (alertTitle) {
            alertTitle.textContent = "NO SIGNALS TODAY";
            alertTitle.className = "font-display font-bold text-sm text-slate-400";
          }
          if (alertDesc) alertDesc.textContent = "Monitoring watchlists...";
        }
      }

      // 4. Sectors
      const sectors = data.sector_rotation || {};
      const topS = (sectors.top_sectors || []).map(s => `<span class="bg-emerald-900/30 text-emerald-400 px-1.5 rounded text-xs border border-emerald-800">${s.sector}</span>`).join('');
      const botS = (sectors.bottom_sectors || []).map(s => `<span class="bg-red-900/30 text-red-400 px-1.5 rounded text-xs border border-red-800">${s.sector}</span>`).join('');
      
      if (topS) {
        const secSection = document.getElementById('sector-section');
        if (secSection) {
          secSection.classList.remove('hidden');
          const secTop = document.getElementById('sector-top');
          if (secTop) secTop.innerHTML = topS;
          const secBot = document.getElementById('sector-bottom');
          if (secBot) secBot.innerHTML = botS;
        }
      }

      // 5. Portfolio Section
      const pfPrompt = data.prompts?.pf || "";
      const hasUrgent = pfPrompt.includes("üö® URGENT");
      const hasAdd = pfPrompt.includes("üü¢ ADD");
      const sellMatches = (pfPrompt.match(/üî¥ SELL|üü† REDUCE/g) || []).length;
      
      if (pfPrompt.length > 50) {
        const pfSec = document.getElementById('portfolio-section');
        if (pfSec) {
          pfSec.classList.remove('hidden');
          
          const healthEl = document.getElementById('portfolio-health');
          if (healthEl) {
            if (hasUrgent) {
              pfSec.classList.add('border-red-500');
              healthEl.textContent = "CRITICAL";
              healthEl.className = "px-2 py-1 rounded bg-red-900 text-white text-xs font-bold border border-red-700 animate-pulse";
            } else {
              healthEl.textContent = "REVIEW";
            }
          }

          if (sellMatches > 0) {
            const sellCont = document.getElementById('sell-signals-container');
            if (sellCont) sellCont.classList.remove('hidden');
            
            const sellList = document.getElementById('sell-signals-list');
            if (sellList) {
              sellList.innerHTML = `
                <div class="text-xs text-slate-300 bg-red-900/20 p-2 rounded border border-red-500/20">
                  Found ${sellMatches} potential sell signals.<br>Check prompt for details.
                </div>
              `;
            }
          }
          
          if (hasAdd) {
            const addCont = document.getElementById('addon-signals-container');
            if (addCont) addCont.classList.remove('hidden');
            
            const addList = document.getElementById('addon-signals-list');
            if (addList) {
              addList.innerHTML = `
                <div class="text-xs text-slate-300 bg-emerald-900/20 p-2 rounded border border-emerald-500/20">
                  Add-on opportunities detected.
                </div>
              `;
            }
          }
        }
      }

      // 6. Day Trade Section
      const dayPrompt = data.prompts?.short || "";
      if (dayPrompt.length > 50) {
        const dtSec = document.getElementById('daytrade-section');
        if (dtSec) dtSec.classList.remove('hidden');
        
        const vwapMatch = dayPrompt.match(/VWAP\*\*: ([A-Z]+)/);
        const orbMatch = dayPrompt.match(/ORB\*\*: ([A-Z_]+)/);
        const mktMatch = dayPrompt.match(/Market Status\*\*: (.*)/);
        
        const mh = document.getElementById('market-hours');
        if (mh && mktMatch) mh.textContent = mktMatch[1].replace(/[üü¢üî¥]/g, '').trim();
        
        const vwap = document.getElementById('vwap-status');
        if (vwap && vwapMatch) vwap.textContent = vwapMatch[1];
        
        const orb = document.getElementById('orb-status');
        if (orb && orbMatch) orb.textContent = orbMatch[1];
        
        const lines = dayPrompt.split('\n');
        const picks = lines.filter(l => l.includes('|')).slice(4, 8); 
        if (picks.length > 0) {
          const dtCand = document.getElementById('daytrade-candidates');
          if (dtCand) dtCand.classList.remove('hidden');
          
          const dtList = document.getElementById('daytrade-list');
          if (dtList) {
            dtList.innerHTML = picks.map(p => {
              const cols = p.split('|').map(c => c.trim()).filter(c => c);
              if (cols.length < 2) return '';
              return `<div class="flex justify-between text-xs border-b border-slate-800 pb-1">
                <span class="font-bold text-slate-300">${cols[1]}</span>
                <span class="text-slate-500">${cols[2]}</span>
              </div>`;
            }).join('');
          }
        }
      }

      // 7. Buttons Availability
      const avail = data.availability || {};
      setBtnState('btn-pf', avail.pf);
      setBtnState('btn-day', avail.short);
      setBtnState('btn-long-p1', avail.long_p1);
      setBtnState('btn-long-p2', avail.long_p2);
      setBtnState('btn-swing-p1', avail.swing_p1);
      setBtnState('btn-swing-p2', avail.swing_p2);
    }

    // --- Helpers ---
    function formatTime(iso) {
      if (!iso) return '--';
      const d = new Date(iso);
      return d.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    function getRegimeColor(regime) {
      if (regime.includes('STRONG_BULL')) return 'text-purple-400';
      if (regime.includes('BULL')) return 'text-emerald-400';
      if (regime.includes('BEAR') || regime.includes('CORRECTION')) return 'text-red-400';
      return 'text-amber-400';
    }

    function updateStat(id, val) {
      const el = document.getElementById(id);
      if (!el) return; // FIX: Added safety check
      el.textContent = val;
      if (val > 0) el.classList.add('text-neon-blue');
    }

    function setBtnState(id, enabled) {
      const btn = document.getElementById(id);
      if (!btn) return; // FIX: Added safety check
      if (!enabled) {
        btn.classList.add('opacity-50', 'cursor-not-allowed', 'grayscale');
        btn.onclick = null;
      }
    }

    function toggleSection(id) {
      const el = document.getElementById(id);
      if (!el) return; // FIX: Added safety check
      const icon = document.getElementById(`icon-${id}`);
      
      if (el.classList.contains('hidden')) {
        el.classList.remove('hidden');
        if (icon) icon.classList.add('rotate-180');
      } else {
        el.classList.add('hidden');
        if (icon) icon.classList.remove('rotate-180');
      }
    }

    function toggleCrossVal() {
      const panel = document.getElementById('crossval-panel');
      if (!panel) return;
      const icon = document.getElementById('crossval-icon');
      
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        if (icon) icon.classList.add('rotate-180');
      } else {
        panel.classList.add('hidden');
        if (icon) icon.classList.remove('rotate-180');
      }
    }

    function renderSignals(signals, containerId, colorClass) {
      const container = document.getElementById(containerId);
      if (!container) return; // FIX: Added safety check
      container.innerHTML = ''; 

      if (!signals || signals.length === 0) return;

      signals.forEach(sig => {
        let icon = 'üí´';
        if (sig.confidence === 'HIGH') icon = 'üî•';
        if (sig.confidence === 'MEDIUM') icon = '‚ú®';
        
        const html = `
          <div class="bg-slate-900/50 rounded-lg p-3 border border-slate-700/50 flex justify-between items-start">
            <div>
              <div class="flex items-center gap-2">
                <span class="font-mono font-bold text-white text-sm">${sig.ticker}</span>
                <span class="text-[10px] px-1.5 py-0.5 rounded bg-white/10 text-slate-300">${sig.signal_type}</span>
              </div>
              <div class="text-xs text-slate-400 mt-1">${sig.notes || ''}</div>
            </div>
            <div class="text-right">
              <div class="font-mono text-sm text-white">$${sig.price}</div>
              <div class="text-xs ${colorClass} font-bold">${icon} ${sig.confidence}</div>
            </div>
          </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
      });
    }

    // --- Logic: Calculator ---
    const calcInputs = ['calc-eq', 'calc-risk', 'calc-entry', 'calc-stop'];
    calcInputs.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('input', updateCalc);
    });

    function updateCalc() {
      const eqEl = document.getElementById('calc-eq');
      const riskEl = document.getElementById('calc-risk');
      const entryEl = document.getElementById('calc-entry');
      const stopEl = document.getElementById('calc-stop');
      
      if (!eqEl || !riskEl || !entryEl || !stopEl) return;

      const eq = parseFloat(eqEl.value) || 0;
      const riskPct = parseFloat(riskEl.value) || 0;
      const entry = parseFloat(entryEl.value) || 0;
      const stop = parseFloat(stopEl.value) || 0;

      const riskAmt = eq * (riskPct / 100);
      const resRisk = document.getElementById('res-risk');
      if (resRisk) resRisk.textContent = `$${Math.round(riskAmt)}`;

      const resShares = document.getElementById('res-shares');
      const resCost = document.getElementById('res-cost');

      if (entry > 0 && stop > 0 && entry > stop) {
        const riskPerShare = entry - stop;
        const shares = Math.floor(riskAmt / riskPerShare);
        const cost = shares * entry;
        
        if (resShares) resShares.textContent = shares.toLocaleString();
        if (resCost) resCost.textContent = `$${Math.round(cost).toLocaleString()}`;
      } else {
        if (resShares) resShares.textContent = "0";
        if (resCost) resCost.textContent = "$0";
      }
    }

    // --- Logic: Copy & Generate ---
    async function copyPrompt(key) {
      if (!appData || !appData.prompts || !appData.prompts[key]) {
        showToast("NO DATA");
        return;
      }
      
      const text = appData.prompts[key];
      try {
        await navigator.clipboard.writeText(text);
        showToast("COPIED!");
      } catch (err) {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("COPIED!");
      }
    }

    function generateCrossVal(type) {
      const gSummary = document.getElementById('gemini-summary').value;
      const cSummary = document.getElementById('claude-summary').value;
      
      if (!gSummary || !cSummary) {
        showToast("MISSING INPUT");
        return;
      }

      const prompt = `# üî¨ Cross-Validation: ${type === 'lt' ? 'Long-Term' : 'Swing'}
Date: ${appData.metadata.date}

---
## ‚ö†Ô∏è CRITICAL: Devil's Advocate Constraint
**If opinions diverge, default to PASS.** (False positives > False negatives)

---
## üìä Analyst A (Gemini)
${gSummary}

---
## üìä Analyst B (Claude)
${cSummary}

---
## üéØ Task: Final Verdict
Compare A & B. Return structured JSON with "final_decision": "PROCEED" or "PASS".
`;
      
      navigator.clipboard.writeText(prompt).then(() => {
        showToast("GENERATED & COPIED");
      });
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      const m = document.getElementById('toast-msg');
      if (!t || !m) return;
      
      m.textContent = msg;
      
      t.classList.remove('opacity-0', 'translate-y-4');
      setTimeout(() => {
        t.classList.add('opacity-0', 'translate-y-4');
      }, 2000);
    }
  </script>
</body>
</html>