<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#020617">
  <title>US Stock Analyzer - Command Center</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Chakra Petch"', 'sans-serif'],
            display: ['"Orbitron"', 'sans-serif'],
            mono: ['"JetBrains Mono"', 'monospace'],
          },
          colors: {
            bg: {
              main: '#020617', // Slate 950
              surface: '#0f172a', // Slate 900
            },
            tech: {
              blue: '#3b82f6',
              purple: '#8b5cf6',
              cyan: '#06b6d4',
              emerald: '#10b981',
              amber: '#f59e0b',
              red: '#ef4444',
            }
          },
          backgroundImage: {
            'grid-pattern': "linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)",
            'radial-glow': "radial-gradient(circle at center, rgba(59, 130, 246, 0.08) 0%, rgba(2, 6, 23, 0) 70%)",
          },
          boxShadow: {
            'neon-blue': '0 0 10px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.3)',
            'neon-amber': '0 0 10px rgba(245, 158, 11, 0.5), 0 0 20px rgba(245, 158, 11, 0.3)',
            'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
            'inner-light': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.1)',
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'scanline': 'scanline 8s linear infinite',
          },
          keyframes: {
            scanline: {
              '0%': { transform: 'translateY(-100%)' },
              '100%': { transform: 'translateY(100%)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; border: 1px solid #0f172a; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    /* Base Setup */
    body {
      background-color: #020617;
      background-image: 
        radial-gradient(circle at 50% 0%, #1e293b 0%, transparent 60%),
        linear-gradient(rgba(2, 6, 23, 0.8), rgba(2, 6, 23, 0.95));
      overflow-x: hidden;
      /* Ensure bottom spacing for home indicator */
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Tech Background Grid */
    .bg-grid-tech {
      background-size: 40px 40px;
      mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
      -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      opacity: 0.1;
      pointer-events: none;
    }

    /* Advanced Glass Panel */
    .glass-hud {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255,255,255,0.05);
      position: relative;
    }

    /* Decorative Corner Accents */
    .hud-corner::before, .hud-corner::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      transition: all 0.3s ease;
      opacity: 0.5;
    }
    .hud-corner::before { top: -1px; left: -1px; border-top: 1px solid white; border-left: 1px solid white; }
    .hud-corner::after { bottom: -1px; right: -1px; border-bottom: 1px solid white; border-right: 1px solid white; }
    
    .glass-hud:hover .hud-corner::before, .glass-hud:hover .hud-corner::after {
      width: 100%; height: 100%;
      opacity: 0.1;
      border-color: var(--accent-color, #3b82f6);
    }

    /* Text Glow Utilities */
    .text-glow-blue { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
    .text-glow-amber { text-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
    .text-glow-purple { text-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
    .text-glow-red { text-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
    .text-glow-white { text-shadow: 0 0 8px rgba(255, 255, 255, 0.3); }

    /* Input Reset & Styles */
    input[type="number"]::-webkit-inner-spin-button, 
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

    .input-tech {
      background: rgba(2, 6, 23, 0.8);
      border: 1px solid rgba(51, 65, 85, 0.5);
      color: #e2e8f0;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }
    .input-tech:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.3), 0 0 15px rgba(59, 130, 246, 0.2);
      background: rgba(2, 6, 23, 1);
    }

    /* Accordion Animation */
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    details[open] summary ~ * { animation: slideDown 0.3s ease-out forwards; }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Scanline Overlay for "Screen" feel */
    .scanline-overlay {
      position: fixed;
      top: 0; left: 0; w: 100%; h: 100%;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
      background-size: 100% 2px, 3px 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.2;
    }
  </style>
</head>
<body class="text-slate-300 min-h-screen font-sans selection:bg-tech-blue selection:text-white pb-24 lg:pb-12">

  <div class="bg-grid-tech bg-grid-pattern"></div>
  <div class="scanline-overlay"></div>

  <header class="fixed top-0 left-0 right-0 z-50 border-b border-white/5 bg-[#020617]/80 backdrop-blur-xl pt-[env(safe-area-inset-top)]">
    <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent"></div>
    <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="relative flex items-center justify-center w-8 h-8 rounded bg-slate-900 border border-slate-700 overflow-hidden group">
          <div class="absolute inset-0 bg-blue-500/20 animate-pulse"></div>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative z-10 text-blue-400 group-hover:scale-110 transition-transform"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
        </div>
        <div>
          <h1 class="font-display font-bold text-lg tracking-wider text-white text-glow-white leading-none">
            STOCK<span class="text-blue-500">ANALYZER</span>
          </h1>
          <div class="text-[10px] font-mono text-slate-500 tracking-[0.2em] uppercase">Tactical Command</div>
        </div>
      </div>
      
      <div id="header-status" class="flex items-center gap-2 sm:gap-4 text-xs font-mono hidden">
        <div class="flex items-center gap-2 px-2 sm:px-3 py-1.5 rounded bg-slate-900/80 border border-slate-700/50 shadow-inner-light">
          <span class="text-slate-500 font-bold hidden sm:inline">MKT:</span>
          <span id="market-regime-badge" class="font-bold text-white tracking-wide">--</span>
        </div>
        <div id="risk-appetite-header" class="flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border hidden">
          <span id="risk-appetite-header-icon" class="text-sm">‚ö†Ô∏è</span>
          <span id="risk-appetite-header-score" class="font-bold">--</span>
        </div>
        <div class="text-slate-500 hidden sm:block border-l border-slate-800 pl-4" id="header-date">--</div>
      </div>

      <button onclick="location.reload()" class="p-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg active:scale-95 transition-all border border-transparent hover:border-white/10 group">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:rotate-180 transition-transform duration-500"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
      </button>
    </div>
  </header>

  <main class="pt-[calc(5rem+env(safe-area-inset-top))] px-4 max-w-7xl mx-auto">
    
    <div id="loader-screen" class="min-h-[60vh] flex flex-col items-center justify-center animate-in fade-in duration-700">
      <div class="w-full max-w-md relative group">
        <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 via-purple-600 to-cyan-600 rounded-2xl blur opacity-20 group-hover:opacity-40 transition duration-1000"></div>
        
        <div class="glass-hud rounded-2xl p-8 text-center relative overflow-hidden bg-[#020617]/90">
          <div class="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
          
          <div class="mb-8 relative inline-flex">
            <div class="absolute inset-0 bg-blue-500 blur-xl opacity-20 animate-pulse-slow"></div>
            <div class="relative w-24 h-24 rounded-full bg-slate-900 border border-slate-700 flex items-center justify-center shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-blue-400 animate-pulse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </div>
          </div>
          
          <h2 class="text-3xl font-display font-bold text-white mb-2 text-glow-white">SYSTEM INITIALIZE</h2>
          <p class="text-slate-500 text-sm mb-8 font-mono">Awaiting Data Module <span class="text-blue-400">[JSON]</span></p>
          
          <div class="relative w-full group/btn">
            <input type="file" id="file-input" accept=".json,application/json" class="absolute inset-0 w-full h-full opacity-0 z-50 cursor-pointer" />
            
            <div class="w-full bg-blue-600 group-hover/btn:bg-blue-500 text-white font-display font-bold py-4 rounded-xl transition-all shadow-neon-blue border border-blue-400/50 flex items-center justify-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              <span>UPLOAD SOURCE FILE</span>
            </div>
            <div class="mt-3 text-[10px] text-slate-600 font-mono uppercase tracking-widest text-center">Select mobile_prompts.json</div>
          </div>

        </div>
      </div>
    </div>

    <div id="dashboard" class="hidden animate-in fade-in zoom-in-95 duration-500">
      
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        
        <div class="glass-hud rounded-xl p-5 hud-corner hover:-translate-y-1 transition-transform duration-300" style="--accent-color: #3b82f6">
          <div class="flex items-start justify-between mb-2">
            <h3 class="text-blue-400 text-[10px] font-display font-bold uppercase tracking-[0.2em]">Long-Term</h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500/50"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 21a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3v4a2 2 0 0 1-2 2h-1Z"/></svg>
          </div>
          <div class="flex items-baseline gap-2 mt-2">
            <span id="lt-signal-count" class="text-4xl font-mono font-bold text-white text-glow-blue">--</span>
            <span class="text-xs text-slate-500 font-bold uppercase">Signals</span>
          </div>
          <div class="mt-4 flex gap-2 text-xs font-mono">
            <div class="bg-slate-900/80 px-2 py-1 rounded border border-slate-700/50 flex-1 text-center">
              <span class="text-slate-500 block text-[9px]">WAIT</span>
              <span id="lt-watch" class="text-slate-200">--</span>
            </div>
            <div class="bg-blue-900/20 px-2 py-1 rounded border border-blue-500/20 flex-1 text-center">
              <span class="text-blue-400 block text-[9px]">READY</span>
              <span id="lt-ready" class="text-white font-bold">--</span>
            </div>
          </div>
        </div>

        <div class="glass-hud rounded-xl p-5 hud-corner hover:-translate-y-1 transition-transform duration-300" style="--accent-color: #f59e0b">
          <div class="flex items-start justify-between mb-2">
            <h3 class="text-amber-400 text-[10px] font-display font-bold uppercase tracking-[0.2em]">Swing</h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500/50"><path d="M2 12h5"/><path d="M17 12h5"/><path d="M7 12a5 5 0 0 1 5-5 5 5 0 0 1 5 5"/></svg>
          </div>
          <div class="flex items-baseline gap-2 mt-2">
            <span id="swing-signal-count" class="text-4xl font-mono font-bold text-white text-glow-amber">--</span>
            <span class="text-xs text-slate-500 font-bold uppercase">Signals</span>
          </div>
          <div class="mt-4 flex gap-2 text-xs font-mono">
            <div class="bg-slate-900/80 px-2 py-1 rounded border border-slate-700/50 flex-1 text-center">
              <span class="text-slate-500 block text-[9px]">WAIT</span>
              <span id="swing-watch" class="text-slate-200">--</span>
            </div>
            <div class="bg-amber-900/20 px-2 py-1 rounded border border-amber-500/20 flex-1 text-center">
              <span class="text-amber-400 block text-[9px]">READY</span>
              <span id="swing-ready" class="text-white font-bold">--</span>
            </div>
          </div>
        </div>

        <div class="glass-hud rounded-xl p-5 hover:-translate-y-1 transition-transform duration-300">
          <div class="flex items-start justify-between mb-2">
            <h3 class="text-slate-400 text-[10px] font-display font-bold uppercase tracking-[0.2em]">Total Watch</h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          </div>
          <div class="flex items-baseline gap-2 mt-2">
            <span id="stat-watch" class="text-3xl font-mono font-bold text-white">--</span>
          </div>
          <div class="mt-5 relative h-1.5 w-full bg-slate-800 rounded-full overflow-hidden">
            <div id="progress-bar" class="absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-amber-500 w-0 transition-all duration-1000 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
          </div>
        </div>

        <div class="glass-hud rounded-xl p-5 hover:-translate-y-1 transition-transform duration-300">
          <div class="flex items-start justify-between mb-2">
            <h3 class="text-slate-400 text-[10px] font-display font-bold uppercase tracking-[0.2em]">Charts</h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
          </div>
          <div class="flex items-baseline gap-2 mt-2">
            <span id="stat-charts" class="text-3xl font-mono font-bold text-white">--</span>
          </div>
          <div class="mt-4 text-[10px] text-slate-500 font-mono flex items-center gap-1">
            <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
            Syncing Drive...
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <div class="col-span-full space-y-4">
          <div id="signal-alert" class="hidden p-1 rounded-xl bg-gradient-to-r from-emerald-500/20 to-transparent border border-emerald-500/30 transition-all duration-300">
            <div class="bg-slate-900/80 backdrop-blur rounded-lg p-4 flex items-center gap-4">
              <div class="p-2.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20" id="alert-icon"></div>
              <div>
                <h3 id="signal-alert-title" class="font-display font-bold text-sm text-emerald-400 tracking-wide">--</h3>
                <p id="signal-alert-desc" class="text-xs text-slate-400 mt-0.5 font-mono">--</p>
              </div>
            </div>
          </div>


          <!-- Risk Appetite Directive Alert (Ver 27.4) -->
          <div id="risk-appetite-alert" class="hidden p-1 rounded-xl transition-all duration-300">
            <div class="bg-slate-900/80 backdrop-blur rounded-lg p-4">
              <div class="flex items-start gap-4">
                <div id="risk-appetite-icon" class="p-2.5 rounded-lg flex-shrink-0"></div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <h3 id="risk-appetite-title" class="font-display font-bold text-sm tracking-wide">--</h3>
                    <span id="risk-appetite-score" class="text-[10px] font-mono px-2 py-0.5 rounded">--</span>
                  </div>
                  <p id="risk-appetite-desc" class="text-xs text-slate-400 mt-0.5 font-mono">--</p>
                  <div id="risk-appetite-indicators" class="mt-3 flex flex-wrap gap-1.5"></div>
                </div>
              </div>
              <div id="risk-appetite-action" class="mt-4 pt-3 border-t border-slate-700/50 hidden">
                <p class="text-xs font-mono text-slate-300"></p>
              </div>
            </div>
          </div>

          <button onclick="copyPrompt('translate')" class="group relative w-full overflow-hidden rounded-xl p-[1px]">
            <div class="absolute inset-0 bg-gradient-to-r from-violet-600 via-purple-500 to-indigo-600 animate-pulse opacity-70 group-hover:opacity-100 transition-opacity"></div>
            <div class="relative bg-slate-900 hover:bg-slate-900/90 rounded-xl p-4 flex items-center justify-center gap-3 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-400 group-hover:text-white transition-colors"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>
              <span class="font-display font-bold text-sm text-white tracking-widest">COPY TRANSLATION PROMPT</span>
            </div>
          </button>
        </div>

        <div id="lt-section" class="glass-hud rounded-xl p-6 border-t-2 border-t-blue-500 hidden group">
          <div class="absolute top-0 right-0 p-3 opacity-20 pointer-events-none group-hover:opacity-10 transition-opacity">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="1"><path d="M3 3v18h18"/></svg>
          </div>
          
          <div class="flex items-center justify-between mb-6 relative z-10">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-blue-500/10 flex items-center justify-center border border-blue-500/30">
                <span class="text-lg">üìà</span>
              </div>
              <h3 class="font-display font-bold text-base text-blue-400 uppercase tracking-widest text-glow-blue">Long-Term</h3>
            </div>
            <div id="badge-long" class="text-[10px] font-mono font-bold bg-blue-500 text-black px-2 py-0.5 rounded shadow-[0_0_10px_rgba(59,130,246,0.6)] hidden">0 SIG</div>
          </div>

          <div class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <button onclick="copyPrompt('long_p1')" id="btn-long-p1" class="relative overflow-hidden bg-slate-800/50 hover:bg-blue-600/10 border border-slate-700 hover:border-blue-500 text-slate-300 py-4 rounded-lg transition-all group/btn">
                <div class="absolute inset-0 bg-blue-400/5 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                <span class="block text-xs font-bold uppercase tracking-wider mb-1 group-hover/btn:text-white relative z-10">1. Quick Screen</span>
                <span class="block text-[9px] opacity-60 font-mono relative z-10">A/D Days Check</span>
              </button>
              <button onclick="copyPrompt('long_p2')" id="btn-long-p2" class="relative overflow-hidden bg-slate-800/50 hover:bg-blue-600/10 border border-slate-700 hover:border-blue-500 text-slate-300 py-4 rounded-lg transition-all group/btn">
                <div class="absolute inset-0 bg-blue-400/5 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                <span class="block text-xs font-bold uppercase tracking-wider mb-1 group-hover/btn:text-white relative z-10">2. Deep Analysis</span>
                <span class="block text-[9px] opacity-60 font-mono relative z-10">Pre-Mortem</span>
              </button>
            </div>

            <button onclick="copyPrompt('lt_summary')" class="w-full bg-slate-800 hover:bg-indigo-900/30 border border-slate-700 hover:border-indigo-400 text-indigo-300 hover:text-indigo-200 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              <span>3. GET SUMMARY PROMPT</span>
            </button>

            <details class="group/acc bg-slate-950/30 rounded-lg border border-white/5 overflow-hidden">
              <summary class="p-4 text-xs font-bold text-slate-400 uppercase tracking-wide cursor-pointer hover:bg-white/5 hover:text-cyan-300 flex items-center justify-between transition-colors">
                <span class="flex items-center gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-cyan-500 group-hover/acc:shadow-[0_0_8px_rgba(6,182,212,0.8)] transition-shadow"></div>
                  4. Cross-Validation
                </span>
                <svg class="w-4 h-4 transition-transform group-open/acc:rotate-180 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              </summary>
              <div class="p-4 space-y-3 border-t border-white/5">
                <p class="text-[9px] text-slate-500 mb-2 font-mono">INPUT ANALYTIC DATA STREAMS:</p>
                <textarea id="lt-gemini-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Gemini Output Signal..."></textarea>
                <textarea id="lt-claude-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Claude Output Signal..."></textarea>
                <button onclick="generateCrossVal('lt')" class="w-full bg-cyan-700/80 hover:bg-cyan-600 text-white py-2.5 rounded text-xs font-bold font-display tracking-wider transition-all shadow-lg hover:shadow-cyan-500/20 active:scale-[0.98]">
                  üî¨ VERIFY & GENERATE FINAL
                </button>
              </div>
            </details>

            <details class="group/acc bg-slate-950/30 rounded-lg border border-white/5 overflow-hidden">
              <summary class="p-4 text-xs font-bold text-slate-400 uppercase tracking-wide cursor-pointer hover:bg-white/5 hover:text-emerald-300 flex items-center justify-between transition-colors">
                <span class="flex items-center gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 group-hover/acc:shadow-[0_0_8px_rgba(16,185,129,0.8)] transition-shadow"></div>
                  5. Export AI Response
                  <span id="lt-stored-badge" class="hidden text-[9px] bg-emerald-500/20 text-emerald-400 px-1.5 py-0.5 rounded font-mono">0</span>
                </span>
                <svg class="w-4 h-4 transition-transform group-open/acc:rotate-180 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              </summary>
              <div class="p-4 space-y-3 border-t border-white/5">
                <p class="text-[9px] text-slate-500 mb-2 font-mono">PASTE FINAL AI RESPONSE (JSON):</p>
                <textarea id="lt-ai-response" rows="4" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste AI final response here (JSON or Markdown with JSON)..."></textarea>
                <div class="flex gap-2">
                  <button onclick="parseAndSaveResponse('lt')" class="flex-1 bg-emerald-700/80 hover:bg-emerald-600 text-white py-2.5 rounded text-xs font-bold font-display tracking-wider transition-all shadow-lg hover:shadow-emerald-500/20 active:scale-[0.98]">
                    üì• PARSE & DOWNLOAD
                  </button>
                  <button onclick="clearStoredResponses('lt')" class="px-3 bg-slate-800 hover:bg-red-900/50 border border-slate-700 hover:border-red-500/50 text-slate-400 hover:text-red-400 py-2.5 rounded text-xs font-bold transition-all active:scale-[0.98]">
                    üóëÔ∏è
                  </button>
                </div>
                <div id="lt-parse-result" class="hidden mt-2 p-3 rounded bg-slate-900/80 border border-slate-700">
                  <div id="lt-parse-items" class="space-y-1 text-[10px] font-mono"></div>
                </div>
              </div>
            </details>
          </div>
        </div>

        <div id="swing-section" class="glass-hud rounded-xl p-6 border-t-2 border-t-amber-500 hidden group">
          <div class="absolute top-0 right-0 p-3 opacity-20 pointer-events-none group-hover:opacity-10 transition-opacity">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="1"><circle cx="12" cy="12" r="10"/></svg>
          </div>
          
          <div class="flex items-center justify-between mb-6 relative z-10">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-amber-500/10 flex items-center justify-center border border-amber-500/30">
                <span class="text-lg">üèÑ</span>
              </div>
              <h3 class="font-display font-bold text-base text-amber-400 uppercase tracking-widest text-glow-amber">Swing</h3>
            </div>
            <div id="badge-swing" class="text-[10px] font-mono font-bold bg-amber-500 text-black px-2 py-0.5 rounded shadow-[0_0_10px_rgba(245,158,11,0.6)] hidden">0 SIG</div>
          </div>

          <div class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <button onclick="copyPrompt('swing_p1')" id="btn-swing-p1" class="relative overflow-hidden bg-slate-800/50 hover:bg-amber-600/10 border border-slate-700 hover:border-amber-500 text-slate-300 py-4 rounded-lg transition-all group/btn">
                <div class="absolute inset-0 bg-amber-400/5 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                <span class="block text-xs font-bold uppercase tracking-wider mb-1 group-hover/btn:text-white relative z-10">1. Quick Screen</span>
                <span class="block text-[9px] opacity-60 font-mono relative z-10">A/D + PEAD</span>
              </button>
              <button onclick="copyPrompt('swing_p2')" id="btn-swing-p2" class="relative overflow-hidden bg-slate-800/50 hover:bg-amber-600/10 border border-slate-700 hover:border-amber-500 text-slate-300 py-4 rounded-lg transition-all group/btn">
                <div class="absolute inset-0 bg-amber-400/5 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                <span class="block text-xs font-bold uppercase tracking-wider mb-1 group-hover/btn:text-white relative z-10">2. Technical</span>
                <span class="block text-[9px] opacity-60 font-mono relative z-10">Pre-Mortem</span>
              </button>
            </div>

            <button onclick="copyPrompt('swing_summary')" class="w-full bg-slate-800 hover:bg-indigo-900/30 border border-slate-700 hover:border-indigo-400 text-indigo-300 hover:text-indigo-200 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              <span>3. GET SUMMARY PROMPT</span>
            </button>

            <details class="group/acc bg-slate-950/30 rounded-lg border border-white/5 overflow-hidden">
              <summary class="p-4 text-xs font-bold text-slate-400 uppercase tracking-wide cursor-pointer hover:bg-white/5 hover:text-amber-300 flex items-center justify-between transition-colors">
                <span class="flex items-center gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-amber-500 group-hover/acc:shadow-[0_0_8px_rgba(245,158,11,0.8)] transition-shadow"></div>
                  4. Cross-Validation
                </span>
                <svg class="w-4 h-4 transition-transform group-open/acc:rotate-180 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              </summary>
              <div class="p-4 space-y-3 border-t border-white/5">
                <p class="text-[9px] text-slate-500 mb-2 font-mono">INPUT ANALYTIC DATA STREAMS:</p>
                <textarea id="swing-gemini-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Gemini Output Signal..."></textarea>
                <textarea id="swing-claude-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Claude Output Signal..."></textarea>
                <button onclick="generateCrossVal('swing')" class="w-full bg-amber-700/80 hover:bg-amber-600 text-white py-2.5 rounded text-xs font-bold font-display tracking-wider transition-all shadow-lg hover:shadow-amber-500/20 active:scale-[0.98]">
                  ‚öñÔ∏è VERIFY & GENERATE FINAL
                </button>
              </div>
            </details>

            <details class="group/acc bg-slate-950/30 rounded-lg border border-white/5 overflow-hidden">
              <summary class="p-4 text-xs font-bold text-slate-400 uppercase tracking-wide cursor-pointer hover:bg-white/5 hover:text-emerald-300 flex items-center justify-between transition-colors">
                <span class="flex items-center gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 group-hover/acc:shadow-[0_0_8px_rgba(16,185,129,0.8)] transition-shadow"></div>
                  5. Export AI Response
                  <span id="swing-stored-badge" class="hidden text-[9px] bg-emerald-500/20 text-emerald-400 px-1.5 py-0.5 rounded font-mono">0</span>
                </span>
                <svg class="w-4 h-4 transition-transform group-open/acc:rotate-180 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              </summary>
              <div class="p-4 space-y-3 border-t border-white/5">
                <p class="text-[9px] text-slate-500 mb-2 font-mono">PASTE FINAL AI RESPONSE (JSON):</p>
                <textarea id="swing-ai-response" rows="4" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste AI final response here (JSON or Markdown with JSON)..."></textarea>
                <div class="flex gap-2">
                  <button onclick="parseAndSaveResponse('swing')" class="flex-1 bg-emerald-700/80 hover:bg-emerald-600 text-white py-2.5 rounded text-xs font-bold font-display tracking-wider transition-all shadow-lg hover:shadow-emerald-500/20 active:scale-[0.98]">
                    üì• PARSE & DOWNLOAD
                  </button>
                  <button onclick="clearStoredResponses('swing')" class="px-3 bg-slate-800 hover:bg-red-900/50 border border-slate-700 hover:border-red-500/50 text-slate-400 hover:text-red-400 py-2.5 rounded text-xs font-bold transition-all active:scale-[0.98]">
                    üóëÔ∏è
                  </button>
                </div>
                <div id="swing-parse-result" class="hidden mt-2 p-3 rounded bg-slate-900/80 border border-slate-700">
                  <div id="swing-parse-items" class="space-y-1 text-[10px] font-mono"></div>
                </div>
              </div>
            </details>
          </div>
        </div>

        <div id="portfolio-section" class="glass-hud rounded-xl p-6 border-t-2 border-t-purple-500 hidden relative overflow-hidden">
          <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          </div>
          
          <div class="flex items-center justify-between mb-6 relative z-10">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-purple-500/10 flex items-center justify-center border border-purple-500/30">
                <span class="text-lg">üíº</span>
              </div>
              <h3 class="font-display font-bold text-base text-purple-400 uppercase tracking-widest text-glow-purple">Portfolio</h3>
            </div>
            <span id="portfolio-health" class="px-2 py-1 rounded bg-slate-900 border border-slate-700 text-[10px] font-mono font-bold text-slate-400">--</span>
          </div>

          <div id="sell-signals-container" class="mb-5 hidden relative z-10">
            <div class="text-[10px] font-bold text-red-400 mb-2 flex items-center gap-2 uppercase tracking-wider animate-pulse">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              Sell Signals Detected
            </div>
            <div id="sell-signals-list" class="space-y-2"></div>
          </div>
          <div id="addon-signals-container" class="hidden mb-5 relative z-10">
            <div class="text-[10px] font-bold text-emerald-400 mb-2 flex items-center gap-2 uppercase tracking-wider">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Add-on Opportunities
            </div>
            <div id="addon-signals-list" class="space-y-2"></div>
          </div>

          <div class="space-y-4 relative z-10">
            <button onclick="copyPrompt('pf')" id="btn-pf" class="w-full bg-slate-800/80 hover:bg-purple-900/30 border border-slate-700 hover:border-purple-500/50 text-purple-300 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex items-center justify-center gap-2 shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="16" x2="16" y1="11" y2="13"/><line x1="8" x2="8" y1="11" y2="13"/><line x1="12" x2="12" y1="15" y2="13"/></svg>
              1. COPY REVIEW PROMPT
            </button>

            <details class="group/acc bg-slate-950/30 rounded-lg border border-white/5 overflow-hidden">
              <summary class="p-4 text-xs font-bold text-slate-400 uppercase tracking-wide cursor-pointer hover:bg-white/5 hover:text-purple-300 flex items-center justify-between transition-colors">
                <span class="flex items-center gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-purple-500 group-hover/acc:shadow-[0_0_8px_rgba(168,85,247,0.8)] transition-shadow"></div>
                  2. Sell/Hold Verification
                </span>
                <svg class="w-4 h-4 transition-transform group-open/acc:rotate-180 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              </summary>
              <div class="p-4 space-y-3 border-t border-white/5">
                <p class="text-[9px] text-slate-500 mb-2 font-mono">INPUT ANALYTIC DATA STREAMS:</p>
                <textarea id="pf-gemini-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Gemini Output Signal..."></textarea>
                <textarea id="pf-claude-summary" rows="3" class="w-full input-tech rounded p-3 text-[10px] resize-none" placeholder="> Paste Claude Output Signal..."></textarea>
                <button onclick="generateCrossVal('pf')" class="w-full bg-purple-900/50 hover:bg-purple-800/80 border border-purple-500/30 text-purple-200 py-2.5 rounded text-xs font-bold transition-all shadow-lg hover:shadow-purple-500/20 active:scale-[0.98]">
                  üõ°Ô∏è GENERATE SELL DECISION
                </button>
              </div>
            </details>
          </div>
        </div>

        <div id="daytrade-section" class="glass-hud rounded-xl p-6 border-t-2 border-t-red-500 hidden">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-red-500/10 flex items-center justify-center border border-red-500/30">
                <span class="text-lg">üèéÔ∏è</span>
              </div>
              <h3 class="font-display font-bold text-base text-red-400 uppercase tracking-widest text-glow-red">Day Trade</h3>
            </div>
            <span id="market-hours" class="text-[10px] font-bold px-2 py-0.5 rounded-sm bg-red-950 text-red-400 border border-red-900 uppercase tracking-wide">--</span>
          </div>

          <div class="grid grid-cols-3 gap-2 mb-4">
            <div class="bg-slate-900/80 rounded border border-slate-700/50 p-2 text-center">
              <div class="text-[9px] text-slate-500 font-bold">VWAP</div>
              <div id="vwap-status" class="text-xs font-mono font-bold mt-1 text-slate-200">--</div>
            </div>
            <div class="bg-slate-900/80 rounded border border-slate-700/50 p-2 text-center">
              <div class="text-[9px] text-slate-500 font-bold">ORB</div>
              <div id="orb-status" class="text-xs font-mono font-bold mt-1 text-slate-200">--</div>
            </div>
            <div class="bg-slate-900/80 rounded border border-slate-700/50 p-2 text-center">
              <div class="text-[9px] text-slate-500 font-bold">GAP</div>
              <div id="gap-status" class="text-xs font-mono font-bold mt-1 text-slate-200">--</div>
            </div>
          </div>

          <div id="daytrade-candidates" class="hidden mb-6">
            <div class="text-[9px] text-slate-400 uppercase font-bold mb-2 tracking-widest border-b border-slate-800 pb-1">Momentum Targets</div>
            <div id="daytrade-list" class="space-y-2 mt-2"></div>
          </div>

          <button onclick="copyPrompt('short')" id="btn-day" class="w-full bg-red-900/20 hover:bg-red-900/40 border border-red-500/30 hover:border-red-500/60 text-red-400 py-3 rounded-lg text-xs font-bold transition-all active:scale-[0.98] flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>
            COPY DAY TRADE PROMPT
          </button>
        </div>

        <div class="space-y-6">
          <div id="sector-section" class="glass-hud rounded-xl p-6 hidden">
            <div class="flex items-center gap-2 mb-4">
              <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
              <h3 class="font-display font-bold text-sm text-emerald-400 uppercase tracking-widest text-glow-white">Sector Flow</h3>
            </div>
            <div class="space-y-4">
              <div>
                <div class="text-[9px] text-slate-500 font-mono mb-2 uppercase tracking-wider">Inflow (Buy)</div>
                <div id="sector-top" class="flex flex-wrap gap-2"></div>
              </div>
              <div class="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent w-full"></div>
              <div>
                <div class="text-[9px] text-slate-500 font-mono mb-2 uppercase tracking-wider">Outflow (Avoid)</div>
                <div id="sector-bottom" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </div>

          <div class="glass-hud rounded-xl p-6 border border-slate-700/30">
            <h3 class="font-display font-bold text-xs text-slate-400 uppercase tracking-widest mb-5 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
              Risk Calculator
            </h3>
            <div class="space-y-3">
              <div class="grid grid-cols-2 gap-3">
                <div class="space-y-1">
                  <label class="text-[9px] text-slate-500 uppercase font-bold ml-1">Capital</label>
                  <input type="number" id="calc-eq" value="10000" class="w-full input-tech rounded px-3 py-2 text-sm text-right outline-none">
                </div>
                <div class="space-y-1">
                  <label class="text-[9px] text-slate-500 uppercase font-bold ml-1">Risk %</label>
                  <input type="number" id="calc-risk" value="1.0" step="0.1" class="w-full input-tech rounded px-3 py-2 text-sm text-right outline-none">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <div class="space-y-1">
                  <label class="text-[9px] text-slate-500 uppercase font-bold ml-1">Entry $</label>
                  <input type="number" id="calc-entry" placeholder="0.00" class="w-full input-tech rounded px-3 py-2 text-sm text-right outline-none">
                </div>
                <div class="space-y-1">
                  <label class="text-[9px] text-slate-500 uppercase font-bold ml-1">Stop $</label>
                  <input type="number" id="calc-stop" placeholder="0.00" class="w-full input-tech rounded px-3 py-2 text-sm text-right outline-none">
                </div>
              </div>
              
              <div class="bg-[#020617] rounded-lg p-4 mt-2 border border-slate-800 relative overflow-hidden">
                <div class="absolute inset-0 bg-blue-900/5"></div>
                <div class="relative z-10">
                  <div class="flex justify-between items-center mb-1">
                    <span class="text-xs text-slate-500 font-bold uppercase">Shares</span>
                    <span id="res-shares" class="font-mono font-bold text-white text-xl text-glow-white">0</span>
                  </div>
                  <div class="h-px bg-slate-800 my-2"></div>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-500">Position Size</span>
                    <span id="res-cost" class="font-mono text-emerald-400 text-sm">$0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-500">Risk Amount</span>
                    <span id="res-risk" class="font-mono text-red-400 text-xs">$0</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Response Export Section -->
          <div id="export-section" class="glass-hud rounded-xl p-6 border border-emerald-500/20 hidden">
            <h3 class="font-display font-bold text-xs text-emerald-400 uppercase tracking-widest mb-4 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              Export AI Responses
              <span id="total-stored-badge" class="text-[9px] bg-emerald-500/20 text-emerald-400 px-1.5 py-0.5 rounded font-mono">0</span>
            </h3>
            <div class="space-y-3">
              <div id="stored-summary" class="text-[10px] font-mono text-slate-400 p-3 bg-slate-900/80 rounded border border-slate-700">
                <div class="flex justify-between mb-1">
                  <span>Long-Term:</span>
                  <span id="lt-count" class="text-blue-400">0 tickers</span>
                </div>
                <div class="flex justify-between">
                  <span>Swing:</span>
                  <span id="swing-count" class="text-amber-400">0 tickers</span>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-2">
                <button onclick="exportResponses('jsonl')" class="bg-emerald-700/80 hover:bg-emerald-600 text-white py-3 rounded text-xs font-bold font-display tracking-wider transition-all shadow-lg hover:shadow-emerald-500/20 active:scale-[0.98]">
                  üì• JSONL
                </button>
                <button onclick="exportResponses('json')" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 py-3 rounded text-xs font-bold font-display tracking-wider transition-all active:scale-[0.98]">
                  üì• JSON
                </button>
              </div>
              <p class="text-[9px] text-slate-600 font-mono text-center">
                ‚Üí Place in input/ai_responses/ai_input.json
              </p>
            </div>
          </div>

        </div>

      </div>
    </div>
  </main>

  <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] pointer-events-none opacity-0 transform translate-y-4 transition-all duration-300">
    <div class="bg-slate-900/90 backdrop-blur-xl text-white px-6 py-3 rounded-lg shadow-2xl border border-blue-500/30 flex items-center gap-3">
      <div class="text-emerald-400 shadow-[0_0_10px_rgba(16,185,129,0.5)] bg-emerald-500/10 rounded-full p-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <span id="toast-msg" class="text-xs font-bold font-display tracking-widest text-blue-100">SYSTEM COPIED</span>
    </div>
  </div>

  <script>
    let appData = null;

    // --- AI Response Storage ---
    const STORAGE_KEY = 'us_stock_analyzer_ai_responses';
    let storedResponses = { lt: [], swing: [] };

    function loadStoredResponses() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          storedResponses = JSON.parse(stored);
        }
      } catch (e) {
        storedResponses = { lt: [], swing: [] };
      }
      updateStoredBadges();
    }

    function saveStoredResponses() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(storedResponses));
      updateStoredBadges();
    }

    function updateStoredBadges() {
      const ltCount = storedResponses.lt.length;
      const swCount = storedResponses.swing.length;
      const total = ltCount + swCount;

      // Update badges
      const ltBadge = document.getElementById('lt-stored-badge');
      const swBadge = document.getElementById('swing-stored-badge');
      const totalBadge = document.getElementById('total-stored-badge');
      const ltCountEl = document.getElementById('lt-count');
      const swCountEl = document.getElementById('swing-count');
      const exportSection = document.getElementById('export-section');

      if (ltBadge) {
        ltBadge.textContent = ltCount;
        ltBadge.classList.toggle('hidden', ltCount === 0);
      }
      if (swBadge) {
        swBadge.textContent = swCount;
        swBadge.classList.toggle('hidden', swCount === 0);
      }
      if (totalBadge) {
        totalBadge.textContent = total;
      }
      if (ltCountEl) ltCountEl.textContent = `${ltCount} tickers`;
      if (swCountEl) swCountEl.textContent = `${swCount} tickers`;

      // Show export section if any responses stored
      if (exportSection) {
        exportSection.classList.toggle('hidden', total === 0);
      }
    }

    function parseAIResponse(content) {
      const results = [];
      content = content.trim();

      // Extract from markdown code blocks
      const codeBlockPattern = /```(?:json)?\s*([\s\S]*?)```/g;
      let match;
      while ((match = codeBlockPattern.exec(content)) !== null) {
        try {
          const parsed = JSON.parse(match[1].trim());
          results.push(...extractRecommendations(parsed));
        } catch (e) { /* continue */ }
      }
      if (results.length > 0) return deduplicateByTicker(results);

      // Try parsing entire content
      try {
        const parsed = JSON.parse(content);
        return deduplicateByTicker(extractRecommendations(parsed));
      } catch (e) { /* continue */ }

      // Try finding JSON in text
      const jsonPatterns = [/(\{[\s\S]*\})/, /(\[[\s\S]*\])/];
      for (const pattern of jsonPatterns) {
        const match = content.match(pattern);
        if (match) {
          try {
            const parsed = JSON.parse(match[1]);
            const extracted = extractRecommendations(parsed);
            if (extracted.length > 0) return deduplicateByTicker(extracted);
          } catch (e) { /* continue */ }
        }
      }
      return [];
    }

    function extractRecommendations(parsed) {
      const results = [];
      if (Array.isArray(parsed)) {
        for (const item of parsed) {
          if (typeof item === 'object' && item.ticker) {
            results.push(normalizeResponse(item));
          }
        }
      } else if (typeof parsed === 'object') {
        if (parsed.recommendations) {
          for (const rec of parsed.recommendations) {
            if (typeof rec === 'object') {
              rec._source_date = parsed.date;
              results.push(normalizeResponse(rec));
            }
          }
        } else if (parsed.approved_tickers) {
          for (const rec of parsed.approved_tickers) {
            if (typeof rec === 'object') {
              if (rec.decision && !rec.recommendation) rec.recommendation = rec.decision;
              results.push(normalizeResponse(rec));
            }
          }
        } else if (parsed.ticker) {
          results.push(normalizeResponse(parsed));
        }
      }
      return results;
    }

    function normalizeResponse(item) {
      return {
        ticker: (item.ticker || '').toUpperCase(),
        recommendation: item.recommendation || item.decision || item.action || 'PROCEED',
        priority: item.priority || item.rank || 0,
        reasons: item.reasons || item.reason || [],
        entry_price: item.entry_price || item.entry || null,
        stop_price: item.stop_price || item.stop || null,
        target_price: item.target_price || item.target || null,
        confidence_score: item.confidence_score || item.confidence || null,
        _imported_at: new Date().toISOString()
      };
    }

    function deduplicateByTicker(items) {
      const seen = {};
      for (const item of items) {
        if (item.ticker) seen[item.ticker] = item;
      }
      return Object.values(seen);
    }

    function parseAndSaveResponse(type) {
      const textarea = document.getElementById(`${type}-ai-response`);
      const resultDiv = document.getElementById(`${type}-parse-result`);
      const itemsDiv = document.getElementById(`${type}-parse-items`);

      if (!textarea || !textarea.value.trim()) {
        showToast("ERROR: NO INPUT");
        return;
      }

      const parsed = parseAIResponse(textarea.value);
      if (parsed.length === 0) {
        showToast("ERROR: PARSE FAILED");
        return;
      }

      // Add analysis_type and format for Cell 9
      const today = new Date().toISOString().split('T')[0];
      parsed.forEach(item => {
        item.analysis_type = type.toUpperCase();
        item.date = today;
        // Normalize recommendation field
        if (item.recommendation) {
          item.ai_recommendation = item.recommendation;
        }
      });

      // Show result preview
      if (resultDiv && itemsDiv) {
        resultDiv.classList.remove('hidden');
        itemsDiv.innerHTML = parsed.map(item => `
          <div class="flex justify-between items-center py-1 border-b border-slate-800 last:border-0">
            <span class="text-white font-bold">${item.ticker}</span>
            <span class="${item.recommendation === 'PROCEED' || item.recommendation === 'BUY' ? 'text-emerald-400' : 'text-red-400'}">${item.recommendation}</span>
          </div>
        `).join('');
      }

      // Create output JSON (format for Cell 9)
      const output = {
        exported_at: new Date().toISOString(),
        date: today,
        type: type.toUpperCase(),
        recommendations: parsed
      };

      // Direct download
      const content = JSON.stringify(output, null, 2);
      const blob = new Blob([content], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ai_input.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      textarea.value = '';
      showToast(`DOWNLOADED ${parsed.length} TICKERS`);
    }

    function clearStoredResponses(type) {
      storedResponses[type] = [];
      saveStoredResponses();

      const resultDiv = document.getElementById(`${type}-parse-result`);
      if (resultDiv) resultDiv.classList.add('hidden');

      showToast(`${type.toUpperCase()} CLEARED`);
    }

    function exportResponses(format) {
      const allResponses = [...storedResponses.lt, ...storedResponses.swing];
      if (allResponses.length === 0) {
        showToast("NO DATA TO EXPORT");
        return;
      }

      const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
      let content, filename;

      if (format === 'jsonl') {
        content = allResponses.map(item => JSON.stringify(item)).join('\n');
        filename = `ai_responses_${date}.jsonl`;
      } else {
        const output = {
          date: date,
          exported_at: new Date().toISOString(),
          recommendations: allResponses
        };
        content = JSON.stringify(output, null, 2);
        filename = `ai_responses_${date}.json`;
      }

      // Download
      const blob = new Blob([content], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast(`EXPORTED ${filename}`);
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', loadStoredResponses);

    // --- File Handling ---
    const fileInput = document.getElementById('file-input');
    fileInput.addEventListener('click', (e) => e.target.value = ''); // Allow re-select
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          // JSON sanitization
          let jsonStr = e.target.result
            .replace(/:\s*NaN\b/g, ': null')
            .replace(/:\s*Infinity\b/g, ': null')
            .replace(/:\s*-Infinity\b/g, ': null');
          
          appData = JSON.parse(jsonStr);
          renderDashboard(appData);
        } catch (error) {
          alert("Error parsing JSON: " + error.message);
        }
      };
      reader.readAsText(file);
    });

    // --- Dashboard Rendering ---
    function renderDashboard(data) {
      // Transition
      const loader = document.getElementById('loader-screen');
      if (loader) loader.classList.add('hidden');
      
      const dash = document.getElementById('dashboard');
      if (dash) dash.classList.remove('hidden');

      // 1. Header Info
      const meta = data.metadata || {};
      const dateEl = document.getElementById('header-date');
      if (dateEl) dateEl.textContent = formatTime(meta.generated_at);
      
      let regime = "NEUTRAL";
      if (data.prompts && data.prompts.long_p1) {
        const match = data.prompts.long_p1.match(/Regime: ([A-Z_]+)/);
        if (match) regime = match[1];
      }
      const regimeEl = document.getElementById('market-regime-badge');
      if (regimeEl) {
        regimeEl.textContent = regime;
        regimeEl.className = `font-bold tracking-wide ${getRegimeColor(regime)}`;
      }
      
      const headerStatus = document.getElementById('header-status');
      if (headerStatus) headerStatus.classList.remove('hidden');

      // 2. Stats & Visibility Logic
      const signals = data.signals || {};
      const ltCount = (signals.long_term || []).length;
      const swCount = (signals.swing || []).length;
      
      updateStat('lt-signal-count', ltCount);
      updateStat('swing-signal-count', swCount);
      
      // Reveal Sections based on data
      if (data.prompts?.long_p1 && data.prompts.long_p1.length > 50) {
        const ltSec = document.getElementById('lt-section');
        if (ltSec) ltSec.classList.remove('hidden');
        
        if (ltCount > 0) {
          const badge = document.getElementById('badge-long');
          if (badge) {
            badge.textContent = `${ltCount} SIG`;
            badge.classList.remove('hidden');
          }
        }
      }
      
      if (data.prompts?.swing_p1 && data.prompts.swing_p1.length > 50) {
        const swSec = document.getElementById('swing-section');
        if (swSec) swSec.classList.remove('hidden');
        
        if (swCount > 0) {
          const badge = document.getElementById('badge-swing');
          if (badge) {
            badge.textContent = `${swCount} SIG`;
            badge.classList.remove('hidden');
          }
        }
      }

      // Watchlist Stats
      const watchlists = data.watchlists || {};
      const ltWatch = document.getElementById('lt-watch');
      if (ltWatch) ltWatch.textContent = watchlists.long_term?.watching || 0;
      
      const ltReady = document.getElementById('lt-ready');
      if (ltReady) ltReady.textContent = watchlists.long_term?.ready || 0;
      
      const swWatch = document.getElementById('swing-watch');
      if (swWatch) swWatch.textContent = watchlists.swing?.watching || 0;
      
      const swReady = document.getElementById('swing-ready');
      if (swReady) swReady.textContent = watchlists.swing?.ready || 0;
      
      const statWatch = document.getElementById('stat-watch');
      if (statWatch) statWatch.textContent = (watchlists.long_term?.watching||0) + (watchlists.swing?.watching||0);
      
      const chartCount = Object.values(data.charts || {}).flat().length;
      const statCharts = document.getElementById('stat-charts');
      if (statCharts) statCharts.textContent = chartCount;

      setTimeout(() => {
        const total = (watchlists.long_term?.watching||0) + (watchlists.swing?.watching||0);
        const max = 100;
        const pct = Math.min(100, (total / max) * 100);
        const pBar = document.getElementById('progress-bar');
        if (pBar) pBar.style.width = `${pct}%`;
      }, 100);

      // 3. Alerts
      const totalSignals = ltCount + swCount;
      const alertDiv = document.getElementById('signal-alert');
      const alertIcon = document.getElementById('alert-icon');
      const alertTitle = document.getElementById('signal-alert-title');
      const alertDesc = document.getElementById('signal-alert-desc');
      
      if (alertDiv) {
        alertDiv.classList.remove('hidden');
        if (totalSignals > 0) {
          // ACTIVE SIGNALS
          alertDiv.className = "p-1 rounded-xl bg-gradient-to-r from-emerald-500/30 to-transparent border border-emerald-500/40 shadow-[0_0_15px_rgba(16,185,129,0.2)]";
          
          if (alertIcon) {
            alertIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-400"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`;
            alertIcon.className = "p-2.5 rounded-lg bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 shadow-[0_0_10px_rgba(16,185,129,0.3)]";
          }
          if (alertTitle) {
            alertTitle.textContent = `${totalSignals} SIGNALS DETECTED`;
            alertTitle.className = "font-display font-bold text-sm text-emerald-400 tracking-wide text-glow-white";
          }
          if (alertDesc) alertDesc.textContent = `${ltCount} Long-Term / ${swCount} Swing targets identified.`;
        } else {
          // NO SIGNALS
          alertDiv.className = "p-1 rounded-xl bg-slate-800/50 border border-slate-700";
          if (alertIcon) {
            alertIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>`;
            alertIcon.className = "p-2.5 rounded-lg bg-slate-800 border border-slate-700 text-slate-500";
          }
          if (alertTitle) {
            alertTitle.textContent = "NO SIGNALS TODAY";
            alertTitle.className = "font-display font-bold text-sm text-slate-400 tracking-wide";
          }
          if (alertDesc) alertDesc.textContent = "Monitoring market conditions...";
        }
      }


      // üö® Risk Appetite Directive (Ver 27.4)
      parseRiskAppetite(data.prompts);

      // 4. Sectors
      const sectors = data.sector_rotation || {};
      const topS = (sectors.top_sectors || []).map(s => `<span class="bg-emerald-900/30 text-emerald-400 px-2 py-0.5 rounded text-[10px] border border-emerald-800 font-bold">${s.sector}</span>`).join('');
      const botS = (sectors.bottom_sectors || []).map(s => `<span class="bg-red-900/30 text-red-400 px-2 py-0.5 rounded text-[10px] border border-red-800 font-bold">${s.sector}</span>`).join('');
      
      if (topS) {
        const secSection = document.getElementById('sector-section');
        if (secSection) {
          secSection.classList.remove('hidden');
          const secTop = document.getElementById('sector-top');
          if (secTop) secTop.innerHTML = topS;
          const secBot = document.getElementById('sector-bottom');
          if (secBot) secBot.innerHTML = botS;
        }
      }

      // 5. Portfolio Section
      const pfPrompt = data.prompts?.pf || "";
      const hasUrgent = pfPrompt.includes("üö® URGENT");
      const hasAdd = pfPrompt.includes("üü¢ ADD");
      const sellMatches = (pfPrompt.match(/üî¥ SELL|üü† REDUCE/g) || []).length;
      
      if (pfPrompt.length > 50) {
        const pfSec = document.getElementById('portfolio-section');
        if (pfSec) {
          pfSec.classList.remove('hidden');
          
          const healthEl = document.getElementById('portfolio-health');
          if (healthEl) {
            if (hasUrgent) {
              // REMOVED: pfSec.classList.add('border-red-500'); (User Feedback: keep standard border)
              healthEl.textContent = "CRITICAL ACTION REQ";
              healthEl.className = "px-2 py-1 rounded bg-red-950 text-red-400 text-[10px] font-bold border border-red-800 animate-pulse shadow-[0_0_10px_rgba(239,68,68,0.5)]";
            } else {
              healthEl.textContent = "ROUTINE REVIEW";
              healthEl.className = "px-2 py-1 rounded bg-slate-900 border border-slate-700 text-[10px] font-mono font-bold text-slate-400";
            }
          }

          if (sellMatches > 0) {
            const sellCont = document.getElementById('sell-signals-container');
            if (sellCont) sellCont.classList.remove('hidden');
            
            const sellList = document.getElementById('sell-signals-list');
            if (sellList) {
              sellList.innerHTML = `
                <div class="text-xs text-red-100 bg-red-900/20 p-3 rounded border border-red-500/20 font-mono">
                  > ALERT: Found ${sellMatches} potential sell signals.<br>> Check prompt for details.
                </div>
              `;
            }
          }
          
          if (hasAdd) {
            const addCont = document.getElementById('addon-signals-container');
            if (addCont) addCont.classList.remove('hidden');
            
            const addList = document.getElementById('addon-signals-list');
            if (addList) {
              addList.innerHTML = `
                <div class="text-xs text-emerald-100 bg-emerald-900/20 p-3 rounded border border-emerald-500/20 font-mono">
                  > STATUS: Add-on opportunities detected.
                </div>
              `;
            }
          }
        }
      }

      // 6. Day Trade Section
      const dayPrompt = data.prompts?.short || "";
      if (dayPrompt.length > 50) {
        const dtSec = document.getElementById('daytrade-section');
        if (dtSec) dtSec.classList.remove('hidden');
        
        const vwapMatch = dayPrompt.match(/VWAP\*\*: ([A-Z]+)/);
        const orbMatch = dayPrompt.match(/ORB\*\*: ([A-Z_]+)/);
        const mktMatch = dayPrompt.match(/Market Status\*\*: (.*)/);
        
        const mh = document.getElementById('market-hours');
        if (mh && mktMatch) mh.textContent = mktMatch[1].replace(/[üü¢üî¥]/g, '').trim();
        
        const vwap = document.getElementById('vwap-status');
        if (vwap && vwapMatch) vwap.textContent = vwapMatch[1];
        
        const orb = document.getElementById('orb-status');
        if (orb && orbMatch) orb.textContent = orbMatch[1];
        
        const lines = dayPrompt.split('\n');
        const picks = lines.filter(l => l.includes('|')).slice(4, 8); 
        if (picks.length > 0) {
          const dtCand = document.getElementById('daytrade-candidates');
          if (dtCand) dtCand.classList.remove('hidden');
          
          const dtList = document.getElementById('daytrade-list');
          if (dtList) {
            dtList.innerHTML = picks.map(p => {
              const cols = p.split('|').map(c => c.trim()).filter(c => c);
              if (cols.length < 2) return '';
              return `<div class="flex justify-between text-xs border-b border-slate-800 pb-2 last:border-0">
                <span class="font-bold text-slate-300 font-mono">${cols[1]}</span>
                <span class="text-slate-500 font-mono">${cols[2]}</span>
              </div>`;
            }).join('');
          }
        }
      }

      // 7. Buttons Availability
      const avail = data.availability || {};
      setBtnState('btn-pf', avail.pf);
      setBtnState('btn-day', avail.short);
      setBtnState('btn-long-p1', avail.long_p1);
      setBtnState('btn-long-p2', avail.long_p2);
      setBtnState('btn-swing-p1', avail.swing_p1);
      setBtnState('btn-swing-p2', avail.swing_p2);
    }

    // --- Helpers ---
    function formatTime(iso) {
      if (!iso) return '--';
      const d = new Date(iso);
      return d.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }).replace(/\//g, '.');
    }


    // üö® Risk Appetite Directive Parser (Ver 27.4)
    function parseRiskAppetite(prompts) {
      const alertDiv = document.getElementById('risk-appetite-alert');
      if (!alertDiv || !prompts) return;
      
      // Parse from any prompt that has Risk Appetite section
      const promptText = prompts.long_p1 || prompts.pf || '';
      
      // Extract Risk Appetite data
      const sentimentMatch = promptText.match(/Sentiment: ([A-Z_]+).*?\(Score: (-?\d+)\)/);
      if (!sentimentMatch) return;
      
      const sentiment = sentimentMatch[1];
      const score = parseInt(sentimentMatch[2]);
      
      // Extract individual indicators
      const indicators = {};
      const indicatorRegex = /([üî¥üü¢]) (\w+): (RISK \w+)/g;
      let match;
      while ((match = indicatorRegex.exec(promptText)) !== null) {
        indicators[match[2]] = match[3];
      }
      
      // Determine tier based on leading indicators
      const smallCapOff = indicators['Small_Cap_Qual'] === 'RISK OFF';
      const creditOff = indicators['Credit_Stress'] === 'RISK OFF';
      const riskOffCount = Object.values(indicators).filter(v => v === 'RISK OFF').length;
      
      let tier, tierColor, tierBg, tierBorder, tierIcon, tierTitle, tierDesc, tierAction;
      
      // Tier 1: CRITICAL - Both leading indicators RISK OFF
      if (smallCapOff && creditOff) {
        tier = 'CRITICAL';
        tierColor = 'text-red-400';
        tierBg = 'from-red-500/30 to-transparent';
        tierBorder = 'border-red-500/40';
        tierIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-400"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`;
        tierTitle = 'RISK APPETITE: CRITICAL';
        tierDesc = '‚õî Both leading indicators (Small_Cap + Credit_Stress) are RISK OFF';
        tierAction = 'ALL new entry signals ‚Üí PASS. Focus on capital preservation.';
      }
      // Tier 2: WARNING - One leading indicator RISK OFF + Score <= -2
      else if ((smallCapOff || creditOff) && score <= -2) {
        tier = 'WARNING';
        tierColor = 'text-amber-400';
        tierBg = 'from-amber-500/30 to-transparent';
        tierBorder = 'border-amber-500/40';
        tierIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-amber-400"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`;
        tierTitle = 'RISK APPETITE: WARNING';
        const leadingOff = smallCapOff ? 'Small_Cap' : 'Credit_Stress';
        tierDesc = `‚ö†Ô∏è Leading indicator ${leadingOff} is RISK OFF`;
        tierAction = 'Only TIER 1 setups ‚Üí PROCEED. Position size: HALF (50%).';
      }
      // Tier 3: CAUTION - Score <= -1
      else if (score <= -1) {
        tier = 'CAUTION';
        tierColor = 'text-yellow-400';
        tierBg = 'from-yellow-500/20 to-transparent';
        tierBorder = 'border-yellow-500/30';
        tierIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-yellow-400"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`;
        tierTitle = 'RISK APPETITE: CAUTION';
        tierDesc = `‚ö° Defensive sentiment (Score: ${score})`;
        tierAction = 'Apply stricter quality filter. R:R minimum: 2.5:1.';
      }
      // Tier 4: Normal
      else if (score >= 3) {
        tier = 'AGGRESSIVE';
        tierColor = 'text-emerald-400';
        tierBg = 'from-emerald-500/20 to-transparent';
        tierBorder = 'border-emerald-500/30';
        tierIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-emerald-400"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
        tierTitle = 'RISK APPETITE: AGGRESSIVE';
        tierDesc = `‚úÖ Strong risk appetite (Score: ${score})`;
        tierAction = '';
      }
      else {
        tier = 'NORMAL';
        tierColor = 'text-slate-400';
        tierBg = 'from-slate-500/10 to-transparent';
        tierBorder = 'border-slate-500/20';
        tierIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-slate-400"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>`;
        tierTitle = 'RISK APPETITE: NORMAL';
        tierDesc = `Standard risk environment (Score: ${score})`;
        tierAction = '';
      }
      
      // Update UI
      alertDiv.classList.remove('hidden');
      alertDiv.className = `p-1 rounded-xl bg-gradient-to-r ${tierBg} border ${tierBorder} transition-all duration-300`;
      
      const iconEl = document.getElementById('risk-appetite-icon');
      if (iconEl) {
        iconEl.innerHTML = tierIcon;
        iconEl.className = `p-2.5 rounded-lg bg-slate-800/80 border border-slate-700/50 flex-shrink-0`;
      }
      
      const titleEl = document.getElementById('risk-appetite-title');
      if (titleEl) {
        titleEl.textContent = tierTitle;
        titleEl.className = `font-display font-bold text-sm tracking-wide ${tierColor}`;
      }
      
      const scoreEl = document.getElementById('risk-appetite-score');
      if (scoreEl) {
        scoreEl.textContent = `${score} (${riskOffCount} RISK OFF)`;
        scoreEl.className = `text-[10px] font-mono px-2 py-0.5 rounded bg-slate-800 border border-slate-700 ${tierColor}`;
      }
      
      const descEl = document.getElementById('risk-appetite-desc');
      if (descEl) descEl.textContent = tierDesc;
      
      // Show indicators
      const indicatorsEl = document.getElementById('risk-appetite-indicators');
      if (indicatorsEl) {
        indicatorsEl.innerHTML = Object.entries(indicators).map(([name, status]) => {
          const isOn = status === 'RISK ON';
          const shortName = name.replace('_Qual', '').replace('_', ' ');
          const bgClass = isOn ? 'bg-emerald-900/30 border-emerald-700/50 text-emerald-400' : 'bg-red-900/30 border-red-700/50 text-red-400';
          const icon = isOn ? 'üü¢' : 'üî¥';
          return `<span class="text-[9px] font-mono px-1.5 py-0.5 rounded border ${bgClass}">${icon} ${shortName}</span>`;
        }).join('');
      }
      
      // Show action if exists
      const actionEl = document.getElementById('risk-appetite-action');
      if (actionEl && tierAction) {
        actionEl.classList.remove('hidden');
        actionEl.querySelector('p').textContent = `‚Üí ${tierAction}`;
        actionEl.querySelector('p').className = `text-xs font-mono ${tierColor}`;
      } else if (actionEl) {
        actionEl.classList.add('hidden');
      }
      
      // Update header Risk Appetite badge
      const headerRisk = document.getElementById('risk-appetite-header');
      const headerIcon = document.getElementById('risk-appetite-header-icon');
      const headerScore = document.getElementById('risk-appetite-header-score');
      
      if (headerRisk) {
        headerRisk.classList.remove('hidden');
        
        // Set colors and icon based on tier
        if (tier === 'CRITICAL') {
          headerRisk.className = 'flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border bg-red-950/80 border-red-500/50 animate-pulse';
          if (headerIcon) headerIcon.textContent = 'üö®';
          if (headerScore) {
            headerScore.textContent = `${score}`;
            headerScore.className = 'font-bold text-red-400';
          }
        } else if (tier === 'WARNING') {
          headerRisk.className = 'flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border bg-amber-950/80 border-amber-500/50';
          if (headerIcon) headerIcon.textContent = '‚ö†Ô∏è';
          if (headerScore) {
            headerScore.textContent = `${score}`;
            headerScore.className = 'font-bold text-amber-400';
          }
        } else if (tier === 'CAUTION') {
          headerRisk.className = 'flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border bg-yellow-950/80 border-yellow-500/50';
          if (headerIcon) headerIcon.textContent = '‚ö°';
          if (headerScore) {
            headerScore.textContent = `${score}`;
            headerScore.className = 'font-bold text-yellow-400';
          }
        } else if (tier === 'AGGRESSIVE') {
          headerRisk.className = 'flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border bg-emerald-950/80 border-emerald-500/50';
          if (headerIcon) headerIcon.textContent = 'üü¢';
          if (headerScore) {
            headerScore.textContent = `+${score}`;
            headerScore.className = 'font-bold text-emerald-400';
          }
        } else {
          // NORMAL - hide the badge if score is 0
          if (score === 0) {
            headerRisk.classList.add('hidden');
          } else {
            headerRisk.className = 'flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded border bg-slate-900/80 border-slate-700/50';
            if (headerIcon) headerIcon.textContent = score > 0 ? '‚úÖ' : '‚ö°';
            if (headerScore) {
              headerScore.textContent = `${score}`;
              headerScore.className = 'font-bold text-slate-400';
            }
          }
        }
      }
    }


    function getRegimeColor(regime) {
      if (regime.includes('STRONG_BULL')) return 'text-purple-400 text-glow-purple';
      if (regime.includes('BULL')) return 'text-emerald-400 text-glow-blue';
      if (regime.includes('BEAR') || regime.includes('CORRECTION')) return 'text-red-400 text-glow-red';
      return 'text-amber-400 text-glow-amber';
    }

    function updateStat(id, val) {
      const el = document.getElementById(id);
      if (!el) return; 
      el.textContent = val;
      // No extra logic needed, color is handled by CSS classes
    }

    function setBtnState(id, enabled) {
      const btn = document.getElementById(id);
      if (!btn) return; 
      if (!enabled) {
        btn.classList.add('opacity-50', 'cursor-not-allowed', 'grayscale');
        btn.onclick = null;
      }
    }

    // --- Logic: Calculator ---
    const calcInputs = ['calc-eq', 'calc-risk', 'calc-entry', 'calc-stop'];
    calcInputs.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('input', updateCalc);
    });

    function updateCalc() {
      const eqEl = document.getElementById('calc-eq');
      const riskEl = document.getElementById('calc-risk');
      const entryEl = document.getElementById('calc-entry');
      const stopEl = document.getElementById('calc-stop');
      
      if (!eqEl || !riskEl || !entryEl || !stopEl) return;

      const eq = parseFloat(eqEl.value) || 0;
      const riskPct = parseFloat(riskEl.value) || 0;
      const entry = parseFloat(entryEl.value) || 0;
      const stop = parseFloat(stopEl.value) || 0;

      const riskAmt = eq * (riskPct / 100);
      const resRisk = document.getElementById('res-risk');
      if (resRisk) resRisk.textContent = `$${Math.round(riskAmt)}`;

      const resShares = document.getElementById('res-shares');
      const resCost = document.getElementById('res-cost');

      if (entry > 0 && stop > 0 && entry > stop) {
        const riskPerShare = entry - stop;
        const shares = Math.floor(riskAmt / riskPerShare);
        const cost = shares * entry;
        
        if (resShares) resShares.textContent = shares.toLocaleString();
        if (resCost) resCost.textContent = `$${Math.round(cost).toLocaleString()}`;
      } else {
        if (resShares) resShares.textContent = "0";
        if (resCost) resCost.textContent = "$0";
      }
    }

    // --- Logic: Copy & Generate ---
    async function copyPrompt(key) {
      let text = "";

      // Handle Summary prompts
      if (key === 'lt_summary') {
        text = `# üìù Long-Term Analysis Summary Request

Now, please create a comprehensive summary of your Phase 1 and Phase 2 analysis above.

## Output Format:
For each ticker analyzed, provide:

| Ticker | Decision | Priority | Key Reasons | Warnings | Entry | Stop | Target | R:R |
|--------|----------|----------|-------------|----------|-------|------|--------|-----|

## Decision Criteria:
- **PROCEED**: All mandatory pass conditions cleared + 3+ bonus conditions
- **WATCH**: Minor concerns but worth monitoring
- **PASS**: Any mandatory pass triggered OR insufficient setup quality

## Summary Requirements:
1. List ALL tickers from the analysis
2. Include confidence score (0-100) for each
3. Highlight any A/D Days concerns (D-Days ‚â• 4 = automatic PASS)
4. Note Climax Run status for each ticker
5. Final recommendation with brief reasoning

Please generate the summary now based on your previous analysis.`;
      } else if (key === 'swing_summary') {
        text = `# üìù Swing Analysis Summary Request

Now, please create a comprehensive summary of your Phase 1 and Phase 2 analysis above.

## Output Format:
For each ticker analyzed, provide:

| Ticker | Decision | Priority | Pullback Grade | Key Reasons | Warnings | Entry | Stop | Target | R:R |
|--------|----------|----------|----------------|-------------|----------|-------|------|--------|-----|

## Decision Criteria:
- **PROCEED**: R:R ‚â• 2.0 + Pullback Grade A/B + Weekly trend aligned
- **WATCH**: Decent setup but timing not ideal
- **PASS**: R:R < 2.0 OR Pullback Grade D OR structure broken

## Summary Requirements:
1. List ALL tickers from the analysis
2. Include Pullback Quality Tier (A/B/C/D) for each
3. Verify R:R ratio meets ‚â• 2.0 requirement
4. Note any Hidden Divergence signals detected
5. Check Weekly Trend alignment status
6. Final recommendation with brief reasoning

Please generate the summary now based on your previous analysis.`;
      } else {
        // Regular prompt copy from JSON
        if (!appData || !appData.prompts || !appData.prompts[key]) {
          showToast("NO DATA DETECTED");
          return;
        }
        text = appData.prompts[key];
      }

      try {
        await navigator.clipboard.writeText(text);
        showToast("COPIED TO CLIPBOARD");
      } catch (err) {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("COPIED TO CLIPBOARD");
      }
    }

    function generateCrossVal(type) {
      // Get values from specific textareas
      const gSummary = document.getElementById(`${type}-gemini-summary`).value;
      const cSummary = document.getElementById(`${type}-claude-summary`).value;
      
      if (!gSummary || !cSummary) {
        showToast("ERROR: INPUT MISSING");
        return;
      }

      let prompt = "";

      if (type === 'pf') {
        // Portfolio: Handle Full-Text Multi-Ticker Analysis
        prompt = `# üõ°Ô∏è Portfolio Decision Cross-Validation (Full Scan)
Date: ${appData.metadata.date}

---
## ‚ö†Ô∏è CRITICAL: Risk Management Priority
**Objective:** Compare the two analyst reports below and extract ALL ACTIONABLE signals.
**Rule:** If ANY analyst recommends "SELL" or "TRIM" for a specific ticker, **the final decision for that ticker must lean towards risk reduction.**

---
## üìä Analyst A (Gemini) - Full Report
${gSummary}

---
## üìä Analyst B (Claude) - Full Report
${cSummary}

---
## üéØ Task: Final Verdict per Ticker
The input contains analysis for multiple portfolio positions.
For EACH ticker mentioned in the reports:
1. Compare Analyst A and B's assessment.
2. Determine if a SELL/TRIM signal is valid.
3. Output format:
   - **[TICKER]**: [ACTION (HOLD/TRIM/SELL/ADD)]
     - *Reason*: (Brief reason focusing on downside risk)
`;
      } else {
        // LT/Swing: Handle Full-Text Analysis
        prompt = `# üî¨ Cross-Validation: ${type === 'lt' ? 'Long-Term' : 'Swing'}
Date: ${appData.metadata.date}

---
## ‚ö†Ô∏è CRITICAL: Devil's Advocate Constraint
**Objective:** Extract the final trade decision from the full reports below.
**Rule:** If opinions diverge on a ticker, default to **PASS**. (False positives > False negatives)

---
## üìä Analyst A (Gemini) - Full Report
${gSummary}

---
## üìä Analyst B (Claude) - Full Report
${cSummary}

---
## üéØ Task: Final Verdict
Based on the full analysis above, return a JSON list of approved tickers.
Format:
{
  "approved_tickers": [
    { "ticker": "XYZ", "decision": "PROCEED", "reason": "Both analysts agree on..." }
  ]
}
If no tickers are approved, return empty list.
`;
      }
      
      navigator.clipboard.writeText(prompt).then(() => {
        showToast("VERIFICATION PROMPT COPIED");
      });
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      const m = document.getElementById('toast-msg');
      if (!t || !m) return;
      
      m.textContent = msg;
      
      t.classList.remove('opacity-0', 'translate-y-4');
      setTimeout(() => {
        t.classList.add('opacity-0', 'translate-y-4');
      }, 2000);
    }
  </script>
</body>
</html>